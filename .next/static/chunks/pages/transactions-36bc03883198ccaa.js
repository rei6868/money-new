(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[673],{3978:function(t,e,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/transactions",function(){return a(9239)}])},9239:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return TransactionsHistoryPage}});var n=a(5893),o=a(7294),s=a(2568),i=a(3692),r=a(4539),l=a.n(r),c=a(5832);function TransactionsTable(t){var e;let{tableScrollRef:a,transactions:s,selectedIds:r,onSelectRow:d,onSelectAll:u,selectionSummary:_,onOpenAdvanced:m,onBulkDelete:p,columnDefinitions:y,allColumns:h,visibleColumns:T,pagination:g,isColumnReorderMode:v=!1,onColumnVisibilityChange:b,onColumnOrderChange:f,sortState:H,onSortChange:x,isFetching:S=!1}=t,[C,w]=(0,o.useState)(1),j=(0,o.useCallback)(t=>{w(e=>{let a="function"==typeof t?t(e):t;return Math.min(1.4,Math.max(.8,Math.round(100*a)/100))})},[]),N=(0,o.useCallback)(()=>{j(t=>t+.1)},[j]),B=(0,o.useCallback)(()=>{j(t=>t-.1)},[j]),A=(0,o.useCallback)(()=>{j(1)},[j]),k=(e={fontScale:C,onIncrease:N,onDecrease:B,onReset:A},(0,o.useMemo)(()=>{if(!g)return null;if(!e)return{render:()=>null};let{fontScale:t,onIncrease:a,onDecrease:o,onReset:s}=e,r=t<1.399999,c=t>.8+1e-6,d=1e-6>Math.abs(t-1),u="".concat(Math.round(100*t),"%");return{render:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,n.jsxs)(n.Fragment,{children:[t.selectedCount>0&&(0,n.jsxs)("span",{className:l().selectionCount,children:[t.selectedCount," selected"]}),(0,n.jsxs)("div",{className:l().paginationControls,role:"group","aria-label":"Table pagination and font controls",children:[(0,n.jsxs)("button",{type:"button",className:l().paginationButton,onClick:()=>g.onPageChange(g.currentPage-1),disabled:1===g.currentPage,"aria-label":"Previous page",children:[(0,n.jsx)(i.YFh,{"aria-hidden":!0}),(0,n.jsx)("span",{className:l().paginationButtonText,children:"Prev"})]}),(0,n.jsxs)("button",{type:"button",className:l().fontScaleButton,onClick:o,disabled:!c,"aria-label":"Decrease table font size",children:[(0,n.jsx)(i.ego,{"aria-hidden":!0}),(0,n.jsx)("span",{className:l().fontScaleButtonText,children:"−"})]}),(0,n.jsxs)("div",{className:l().pageSizeGroup,children:[(0,n.jsx)("label",{htmlFor:"transactions-page-size",children:"Rows per page"}),(0,n.jsx)("select",{id:"transactions-page-size",className:l().pageSizeSelect,value:g.pageSize,onChange:t=>g.onPageSizeChange(Number(t.target.value)),children:g.pageSizeOptions.map(t=>(0,n.jsx)("option",{value:t,children:t},t))})]}),(0,n.jsxs)("button",{type:"button",className:"".concat(l().fontScaleButton," ").concat(l().fontScaleReset).trim(),onClick:s,disabled:d,"aria-label":"Reset table font size",children:[(0,n.jsx)(i.Bw1,{"aria-hidden":!0}),(0,n.jsx)("span",{className:l().fontScaleButtonText,children:"Reset"})]}),(0,n.jsxs)("button",{type:"button",className:l().fontScaleButton,onClick:a,disabled:!r,"aria-label":"Increase table font size",children:[(0,n.jsx)(i.OvN,{"aria-hidden":!0}),(0,n.jsx)("span",{className:l().fontScaleButtonText,children:"+"})]}),(0,n.jsxs)("button",{type:"button",className:l().paginationButton,onClick:()=>g.onPageChange(g.currentPage+1),disabled:g.currentPage===g.totalPages,"aria-label":"Next page",children:[(0,n.jsx)(i.Tfp,{"aria-hidden":!0}),(0,n.jsx)("span",{className:l().paginationButtonText,children:"Next"})]})]}),(0,n.jsxs)("div",{className:l().paginationMeta,children:[(0,n.jsxs)("div",{className:l().fontScaleMeta,children:[(0,n.jsx)("span",{className:l().fontScaleLabel,children:"Font size"}),(0,n.jsx)("span",{className:l().fontScaleValue,"aria-live":"polite",children:u})]}),(0,n.jsxs)("span",{className:l().paginationStatus,children:["Page ",g.currentPage," of ",g.totalPages]})]})]})}}},[g,e]));return(0,n.jsx)(c.W8,{tableScrollRef:a,transactions:s,selectedIds:r,onSelectRow:d,onSelectAll:u,selectionSummary:_,onOpenAdvanced:m,onBulkDelete:p,columnDefinitions:y,allColumns:h,visibleColumns:T,pagination:k,isColumnReorderMode:v,onColumnVisibilityChange:b,onColumnOrderChange:f,fontScale:C,sortState:H,onSortChange:x,isShowingSelectedOnly:t.isShowingSelectedOnly,isFetching:S})}var d=a(8350),u=a(7871),transactions_TransactionAdvancedModal=function(t){var e,a,s,r,c,d,_,m,p,y,h;let{panelData:T,onClose:g,onQuickEditSave:v}=t,[b,f]=(0,o.useState)({owner:"",category:"",notes:""}),[H,x]=(0,o.useState)(!1),[S,C]=(0,o.useState)(""),w=null!==(c=null==T?void 0:T.mode)&&void 0!==c?c:null,j=null!==(d=null==T?void 0:T.transaction)&&void 0!==d?d:null,N=null!==(_=null==j?void 0:j.id)&&void 0!==_?_:"",B="edit"===w;if((0,o.useEffect)(()=>{if(!T)return;let handleKeyDown=t=>{"Escape"===t.key&&(null==g||g())};return window.addEventListener("keydown",handleKeyDown),()=>window.removeEventListener("keydown",handleKeyDown)},[T,g]),(0,o.useEffect)(()=>{if(B&&j){var t,e,a;f({owner:null!==(t=j.owner)&&void 0!==t?t:"",category:null!==(e=j.category)&&void 0!==e?e:"",notes:null!==(a=j.notes)&&void 0!==a?a:""})}else f({owner:"",category:"",notes:""});C(""),x(!1)},[B,j]),!T)return null;let handleInputChange=t=>e=>{let{value:a}=e.target;f(e=>({...e,[t]:a}))},handleSave=async()=>{if(!B||!(null==j?void 0:j.id))return;x(!0),C("");let t={owner:b.owner,category:b.category,notes:b.notes};try{let a=await fetch("/api/transactions/action",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"quickEdit",payload:{id:j.id,updates:t}})}),n=await a.json().catch(()=>({status:a.ok?"success":"error"}));if(!a.ok||"success"!==n.status){var e;let t=null!==(e=null==n?void 0:n.message)&&void 0!==e?e:"Failed to save changes. Please try again.";throw Error(t)}let o=n&&"object"==typeof n.updatedRow&&n.updatedRow?n.updatedRow:t;null==v||v(j.id,o),x(!1),null==g||g()}catch(t){C(t instanceof Error?t.message:"Failed to save changes. Please try again."),x(!1)}};return(0,n.jsx)("div",{className:l().advancedOverlay,"data-testid":"transactions-advanced-modal",role:"dialog","aria-modal":"true",children:(0,n.jsxs)("div",{className:l().advancedPanel,children:[(0,n.jsxs)("div",{className:l().advancedHeader,children:[(0,n.jsx)("h3",{className:l().advancedTitle,children:"create"===w?"Quick Create Transaction":"edit"===w?"Edit ".concat(N):"delete"===w?"Delete ".concat(N):"Advanced options for ".concat(N)}),(0,n.jsx)("button",{type:"button",className:l().iconButton,onClick:g,"data-testid":"transactions-advanced-close","aria-label":"Close advanced options",children:(0,n.jsx)(i.$Rx,{"aria-hidden":!0})})]}),"create"===w?(0,n.jsxs)("div",{className:l().modalBody,children:[(0,n.jsxs)("div",{className:l().modalField,children:[(0,n.jsx)("p",{className:l().modalLabel,children:"Status"}),(0,n.jsx)("p",{className:l().advancedValue,children:"Use this space to configure quick entry templates. Builder is coming soon."})]}),(0,n.jsxs)("div",{className:l().modalField,children:[(0,n.jsx)("p",{className:l().modalLabel,children:"Next step"}),(0,n.jsx)("p",{className:l().advancedValue,children:"Connect to your preferred batch input to populate a draft transaction with preset Cashback and Debt parameters."})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:l().modalBody,children:B?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:l().advancedSection,children:[(0,n.jsx)("label",{className:l().modalLabel,htmlFor:"quick-edit-owner",children:"Owner"}),(0,n.jsx)("input",{id:"quick-edit-owner",className:l().modalControl,value:b.owner,onChange:handleInputChange("owner"),placeholder:"Add owner"})]}),(0,n.jsxs)("div",{className:l().advancedSection,children:[(0,n.jsx)("label",{className:l().modalLabel,htmlFor:"quick-edit-category",children:"Category"}),(0,n.jsx)("input",{id:"quick-edit-category",className:l().modalControl,value:b.category,onChange:handleInputChange("category"),placeholder:"Add category"})]}),(0,n.jsxs)("div",{className:l().advancedSection,children:[(0,n.jsx)("label",{className:l().modalLabel,htmlFor:"quick-edit-notes",children:"Notes"}),(0,n.jsx)("textarea",{id:"quick-edit-notes",className:"".concat(l().modalControl," ").concat(l().advancedTextarea).trim(),value:b.notes,onChange:handleInputChange("notes"),placeholder:"Add notes"})]}),(0,n.jsxs)("div",{className:l().advancedSection,children:[(0,n.jsx)("span",{className:l().advancedLabel,children:"Account"}),(0,n.jsx)("span",{className:l().advancedValue,children:null!==(m=null===(e=T.transaction)||void 0===e?void 0:e.account)&&void 0!==m?m:"Not available"})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:l().advancedSection,children:[(0,n.jsx)("span",{className:l().advancedLabel,children:"Owner"}),(0,n.jsx)("span",{className:l().advancedValue,children:null!==(p=null===(a=T.transaction)||void 0===a?void 0:a.owner)&&void 0!==p?p:"Unassigned"})]}),(0,n.jsxs)("div",{className:l().advancedSection,children:[(0,n.jsx)("span",{className:l().advancedLabel,children:"Account"}),(0,n.jsx)("span",{className:l().advancedValue,children:null!==(y=null===(s=T.transaction)||void 0===s?void 0:s.account)&&void 0!==y?y:"Not available"})]}),(0,n.jsxs)("div",{className:l().advancedSection,children:[(0,n.jsx)("span",{className:l().advancedLabel,children:"Notes"}),(0,n.jsx)("span",{className:l().advancedValue,children:null!==(h=null===(r=T.transaction)||void 0===r?void 0:r.notes)&&void 0!==h?h:"—"})]})]})}),(0,n.jsxs)("div",{className:l().metricsGrid,children:[(0,n.jsxs)("div",{className:l().metricTile,children:[(0,n.jsx)("span",{className:l().metricLabel,children:"Amount"}),(0,n.jsx)("span",{className:l().metricValue,children:(0,u.Bo)(null==j?void 0:j.amount)})]}),(0,n.jsxs)("div",{className:l().metricTile,children:[(0,n.jsx)("span",{className:l().metricLabel,children:"Total Back"}),(0,n.jsx)("span",{className:l().metricValue,children:(0,u.Bo)(null==j?void 0:j.totalBack)})]}),(0,n.jsxs)("div",{className:l().metricTile,children:[(0,n.jsx)("span",{className:l().metricLabel,children:"Final Price"}),(0,n.jsx)("span",{className:l().metricValue,children:(0,u.Bo)(null==j?void 0:j.finalPrice)})]})]}),S?(0,n.jsx)("div",{className:l().advancedError,role:"alert","aria-live":"assertive",children:S}):null,(0,n.jsxs)("div",{className:l().modalFooter,children:[(0,n.jsx)("button",{type:"button",className:l().secondaryButton,onClick:g,"data-testid":"transactions-advanced-dismiss",children:"Close"}),"delete"===w?(0,n.jsx)("button",{type:"button",className:"".concat(l().primaryButton," ").concat(l().wrap),"data-testid":"transactions-advanced-confirm-delete",children:"Confirm delete"}):B?(0,n.jsx)("button",{type:"button",className:l().primaryButton,onClick:handleSave,"data-testid":"transactions-advanced-save",disabled:H,children:H?"Saving…":"Save"}):null]})]})]})})},_=a(1210),m=a(7050),p=a(2015),y=a(3735),h=a(4892),T=a.n(h);let g={all:"default",expense:"danger",income:"success",transfer:"primary"};var transactions_TxnTabs=function(t){let{activeTab:e,onTabChange:a,tabs:o}=t;return(0,n.jsx)("div",{className:T().root,role:"tablist","aria-label":"Transaction views",children:o.map(t=>{let o=g[t.id.toLowerCase()]||"default",s=t.id===e;return(0,n.jsxs)("button",{type:"button",className:T().tabButton,"data-active":s?"true":"false","data-color":o,onClick:()=>a(t.id),role:"tab","aria-selected":s,children:[(0,n.jsx)("span",{className:T().tabLabel,children:t.label}),(0,n.jsx)("span",{className:T().tabCount,children:t.count})]},t.id)})})},v=a(4061);let b=[5,10,20,30];function extractString(t){if("string"==typeof t){let e=t.trim();return e.length>0?e:null}return"number"==typeof t&&Number.isFinite(t)?String(t):null}function applyTypeMetadata(t){if(!t||"object"!=typeof t)return t;let e="string"==typeof t.type?t.type:"",a=function(t){let e=[null==t?void 0:t.typeRaw,null==t?void 0:t.typeValue,null==t?void 0:t.type,null==t?void 0:t.transactionType,null==t?void 0:t.transaction_type,null==t?void 0:t.categoryType,null==t?void 0:t.category_type];for(let t of e){let e=(0,v.MT)(t);if(null!=t)return e}return v.A6.OTHER}(t),n=(0,v.yl)(a),o=e&&e.length>0?e:n;return{...t,typeRaw:e,typeValue:a,typeLabel:o,type:o}}function buildTransactionPredicate(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return a=>{if(e&&"all"!==e){var n;let t=extractString(null!==(n=a.typeRaw)&&void 0!==n?n:a.type),o=t?t.toLowerCase():"";if(e===v.A6.TRANSFER){let t=extractString(a.linkedTxn);if("expense"!==o||!t)return!1}else if(o!==e.toLowerCase())return!1}return!t||["notes","description","shop","account","category","owner","type","id"].some(e=>{let n=null==a?void 0:a[e];return null!=n&&String(n).toLowerCase().includes(t)})}}function TransactionsHistoryPage(){var t;let{isAuthenticated:e,isLoading:a}=(0,d.Q)(),[r,c]=(0,o.useState)([]),[u,h]=(0,o.useState)(!0),[T,g]=(0,o.useState)([]),[f,H]=(0,o.useState)(null),[x,S]=(0,o.useState)([]),[C,w]=(0,o.useState)([]),[j,N]=(0,o.useState)([]),[B,A]=(0,o.useState)(!1),[k,R]=(0,o.useState)(null!==(t=b[1])&&void 0!==t?t:b[0]),[L,P]=(0,o.useState)(1),[z,F]=(0,o.useState)({count:0,amount:0,finalPrice:0,totalBack:0}),[I,M]=(0,o.useState)({columnId:null,direction:null}),[O,E]=(0,o.useState)({totalPages:1,totalRows:0}),[D,G]=(0,o.useState)(null),[V,Q]=(0,o.useState)(null),[W,q]=(0,o.useState)(!1),[J,Z]=(0,o.useState)(""),[K,U]=(0,o.useState)("all"),[Y,X]=(0,o.useState)([]),$=(0,o.useRef)(null),tt=(0,o.useRef)(0);(0,o.useEffect)(()=>{$.current&&tt.current>0&&requestAnimationFrame(()=>{$.current&&($.current.scrollLeft=tt.current)})},[r]),(0,o.useEffect)(()=>{if("undefined"==typeof document||!D)return;let t=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=t}},[D]),(0,o.useEffect)(()=>{if(!e)return;let t=!1;return fetch("/api/transactions/types").then(t=>{if(!t.ok)throw Error("Failed to fetch transaction types");return t.json()}).then(e=>{if(t)return;let a=Array.isArray(null==e?void 0:e.types)?e.types:[],n=Array.from(new Set(a.map(t=>"string"==typeof t?t.trim():"").filter(t=>t.length>0)));X(n)}).catch(e=>{t||console.error(e)}),fetch("/api/transactions/columns").then(t=>{if(!t.ok)throw Error("Failed to fetch column metadata");return t.json()}).then(e=>{if(t)return;let a=Array.isArray(e.columns)?e.columns:[],n=new Map(a.map(t=>[t.id,t])),o=Array.isArray(e.defaultState)?e.defaultState:[],s=o.map((t,e)=>{var a,o,s,i,r,l,c,d;let u=null!==(a=n.get(t.id))&&void 0!==a?a:{},_=null!==(o=u.minWidth)&&void 0!==o?o:120,m=t.width,p=null!==(s=u.defaultWidth)&&void 0!==s?s:_,y=Number(m),h=Number.isFinite(y)?y:p;return{id:t.id,width:Math.max(h,_),visible:null!==(i=t.visible)&&void 0!==i?i:!1!==u.defaultVisible,order:null!==(r=t.order)&&void 0!==r?r:e,pinned:null!==(l=t.pinned)&&void 0!==l?l:null,optional:null!==(d=null!==(c=t.optional)&&void 0!==c?c:u.optional)&&void 0!==d&&d}});S(a),N(s.map(t=>({...t}))),w(s)}).catch(e=>{t||console.error(e)}),()=>{t=!0}},[e]);let te=(0,o.useMemo)(()=>new Map(x.map(t=>[t.id,t])),[x]);(0,o.useEffect)(()=>{if(!e||0===x.length)return;let t=!1,a=new AbortController;$.current&&(tt.current=$.current.scrollLeft),h(!0);let n=new URLSearchParams;n.set("page",String(L)),n.set("pageSize",String(k)),(null==I?void 0:I.columnId)&&n.set("sortBy",I.columnId),(null==I?void 0:I.direction)&&n.set("sortDir",I.direction);let o=n.toString(),s=o?"/api/transactions?".concat(o):"/api/transactions";return fetch(s,{signal:a.signal}).then(t=>{if(!t.ok)throw Error("Failed to fetch transactions");return t.json()}).then(e=>{var a;if(t)return;let n=Array.isArray(e.rows)?e.rows.map(t=>applyTypeMetadata(t)):[];c(n),g(t=>{let e=new Set(n.map(t=>t.id));return t.filter(t=>e.has(t))});let o=null!==(a=null==e?void 0:e.pagination)&&void 0!==a?a:{},s=Number(o.totalPages),i=Number(o.totalRows),r=Number(o.pageSize),l=Number(o.page);E(t=>({totalPages:Number.isFinite(s)&&s>0?s:t.totalPages||1,totalRows:Number.isFinite(i)&&i>=0?i:n.length})),Number.isFinite(r)&&r>0&&r!==k&&R(r),Number.isFinite(l)&&l>0&&l!==L&&P(l)}).catch(e=>{t||"AbortError"===e.name||(console.error(e),c([]),E({totalPages:1,totalRows:0}))}).finally(()=>{t||h(!1)}),()=>{t=!0,a.abort()}},[e,x,L,k,null==I?void 0:I.columnId,null==I?void 0:I.direction]);let ta=(0,o.useMemo)(()=>{if(0===C.length)return[];let t=C.slice().sort((t,e)=>t.order-e.order),e=t.filter(t=>"left"===t.pinned),a=t.filter(t=>"right"===t.pinned),n=t.filter(t=>"left"!==t.pinned&&"right"!==t.pinned),o=[...e,...n,...a];return o.map((t,e)=>{var a,n,o,s,i,r;let l=null!==(a=te.get(t.id))&&void 0!==a?a:{},c=null!==(n=l.minWidth)&&void 0!==n?n:120,d=!1!==l.defaultVisible,u=Math.max(null!==(s=null!==(o=t.width)&&void 0!==o?o:l.defaultWidth)&&void 0!==s?s:c,c);return{...l,...t,order:e,width:u,visible:null!==(i=t.visible)&&void 0!==i?i:d,pinned:null!==(r=t.pinned)&&void 0!==r?r:null}})},[C,te]),tn=(0,o.useMemo)(()=>ta.filter(t=>t.visible),[ta]),to=(0,o.useMemo)(()=>{if(Y.length>0)return Y;let t=new Set,e=Array.isArray(r)?r:[];return e.forEach(e=>{var a;let n=extractString(null!==(a=e.typeRaw)&&void 0!==a?a:e.type);n&&t.add(n)}),Array.from(t)},[Y,r]);(0,o.useEffect)(()=>{let t=new Set(r.map(t=>t.id));g(e=>{let a=e.filter(e=>t.has(e));return a.length===e.length?e:a})},[r]),(0,o.useEffect)(()=>{0===T.length&&B&&A(!1)},[T,B]);let ts=(0,o.useMemo)(()=>new Set(T),[T]),ti=(0,o.useMemo)(()=>{let t=Array.isArray(r)?r:[],e=J.trim().toLowerCase(),a=buildTransactionPredicate(e,K);return t.filter(a)},[r,J,K]);(0,o.useEffect)(()=>{let t=new Set(r.map(t=>t.id));g(e=>{let a=e.filter(e=>t.has(e));return a.length===e.length?e:a})},[r]);let tr=(0,o.useMemo)(()=>B?ti.filter(t=>ts.has(t.id)):ti,[ti,ts,B]),tl=(0,o.useCallback)(t=>{if(!t){g([]);return}let e=B?tr:ti,a=Array.isArray(e)?e.map(t=>t.id):[];g(a)},[tr,ti,B]),tc=(0,o.useMemo)(()=>{let t=Array.isArray(r)?r:[],e=J.trim().toLowerCase(),a=buildTransactionPredicate(e,!1),n=t.filter(a),o=new Map;n.forEach(t=>{var e,a;let n=extractString(null!==(e=t.typeRaw)&&void 0!==e?e:t.type);n&&o.set(n,(null!==(a=o.get(n))&&void 0!==a?a:0)+1)});let s=n.filter(t=>{var e;let a=extractString(null!==(e=t.typeRaw)&&void 0!==e?e:t.type),n=extractString(t.linkedTxn);return(null==a?void 0:a.toLowerCase())==="expense"&&!!n}),i=to.filter(t=>t.toLowerCase()!==v.A6.TRANSFER).map(t=>{var e;return{id:t,label:t,count:null!==(e=o.get(t))&&void 0!==e?e:0}}),l=[{id:"all",label:"All",count:n.length},...i];return l.push({id:v.A6.TRANSFER,label:(0,v.yl)(v.A6.TRANSFER),count:s.length}),l},[J,r,to]);(0,o.useEffect)(()=>{if(0===T.length){F({count:0,amount:0,finalPrice:0,totalBack:0});return}let t=!1,e=new AbortController;return fetch("/api/transactions/selection",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:T}),signal:e.signal}).then(t=>{if(!t.ok)throw Error("Failed to fetch selection summary");return t.json()}).then(e=>{var a;t||F(null!==(a=null==e?void 0:e.summary)&&void 0!==a?a:{count:0,amount:0,finalPrice:0,totalBack:0})}).catch(e=>{t||"AbortError"===e.name||(console.error(e),F({count:0,amount:0,finalPrice:0,totalBack:0}))}),()=>{t=!0,e.abort()}},[T]);let td=(0,o.useCallback)((t,e)=>{if(!t||!e){if(null===I.columnId&&null===I.direction)return;M({columnId:null,direction:null}),P(1);return}(I.columnId!==t||I.direction!==e)&&(M({columnId:t,direction:e}),P(1))},[I]),tu=(0,o.useCallback)(()=>{Q(null),G("transaction")},[]),t_=(0,o.useCallback)((t,e)=>{Q(e),G("transaction")},[]),tm=(0,o.useCallback)(()=>{G(null),Q(null)},[]),tp=(0,o.useCallback)(async(t,e)=>{try{"transaction"===t?console.info("Create transaction placeholder",{action:V,payload:e}):"account"===t?console.info("Create account placeholder from transactions page",e):"person"===t&&console.info("Create person placeholder from transactions page",e)}catch(t){console.error("Failed to submit add modal",t)}},[V]),ty=(0,o.useCallback)((t,e)=>{t&&c(a=>{if(!Array.isArray(a)||0===a.length)return a;let n=!1,o=a.map(a=>a.id!==t?a:e&&"object"==typeof e?(n=!0,applyTypeMetadata({...a,...e})):a);return n?o:a})},[]),th=(0,o.useCallback)((t,e)=>{w(a=>a.map(a=>a.id===t?{...a,visible:!!e}:a))},[]),tT=(0,o.useCallback)(t=>{w(e=>{if(!Array.isArray(t)||0===t.length)return e;let a=new Map(t.map((t,e)=>[t,e])),n=e.slice(),o=n.filter(t=>a.has(t.id)),s=n.filter(t=>!a.has(t.id));o.sort((t,e)=>{var n,o;return(null!==(n=a.get(t.id))&&void 0!==n?n:0)-(null!==(o=a.get(e.id))&&void 0!==o?o:0)});let i=[...o,...s];return i.map((t,e)=>({...t,order:e}))})},[]),tg=(0,o.useCallback)(t=>{w(e=>{let a=new Map(e.map(t=>[t.id,t.width])),n=new Map(e.map(t=>[t.id,t.optional]));return t.map((t,e)=>{var o,s,i;return{id:t.id,width:null!==(o=a.get(t.id))&&void 0!==o?o:200,visible:t.visible,order:e,pinned:null!==(s=t.pinned)&&void 0!==s?s:null,optional:null!==(i=n.get(t.id))&&void 0!==i&&i}})})},[]),tv=(0,o.useCallback)(t=>{Z(t)},[]),tb=(0,o.useCallback)(t=>{U(t)},[]),tf=(0,o.useMemo)(()=>{let t=C.slice().sort((t,e)=>t.order-e.order);return t.map(t=>{var e,a,n;let o=null!==(e=te.get(t.id))&&void 0!==e?e:{};return{id:t.id,label:null!==(a=o.label)&&void 0!==a?a:t.id,visible:!1!==t.visible,pinned:null!==(n=t.pinned)&&void 0!==n?n:null,locked:!!o.locked,mandatory:!!o.locked}})},[C,te]),tH=(0,o.useMemo)(()=>{if(!j||0===j.length)return tf;let t=j.slice().sort((t,e)=>t.order-e.order);return t.map(t=>{var e,a,n;let o=null!==(e=te.get(t.id))&&void 0!==e?e:{};return{id:t.id,label:null!==(a=o.label)&&void 0!==a?a:t.id,visible:!1!==t.visible,pinned:null!==(n=t.pinned)&&void 0!==n?n:null,locked:!!o.locked,mandatory:!!o.locked}})},[j,te,tf]),tx=(0,n.jsxs)("div",{className:l().filterActions,children:[(0,n.jsxs)("button",{type:"button",className:l().primaryButton,onClick:tu,disabled:u,"aria-label":"Add transaction",children:[(0,n.jsx)(i.OvN,{"aria-hidden":!0}),(0,n.jsx)("span",{children:"Add transaction"})]}),(0,n.jsx)(p.Z,{context:"transactions",onSelect:t_,disabled:u,triggerLabel:"Quick add",triggerAriaLabel:"Quick add transaction",className:l().filterActionsQuickAdd}),(0,n.jsxs)("button",{type:"button",className:l().secondaryButton,onClick:()=>q(!0),"aria-label":"Customize columns",children:[(0,n.jsx)(i.nbt,{"aria-hidden":!0}),(0,n.jsx)("span",{children:"Customize"})]})]});if(a||!e)return null;let tS=null!==D;return(0,n.jsxs)(s.Z,{title:"Transactions History",subtitle:"Monitor every inflow, cashback, debt movement, and adjustment inside Money Flow.",children:[(0,n.jsxs)("div",{className:l().screen,children:[(0,n.jsxs)("div",{className:l().controlsRegion,children:[(0,n.jsx)(transactions_TxnTabs,{activeTab:K,onTabChange:tb,tabs:tc}),(0,n.jsxs)("div",{className:l().topBar,children:[(0,n.jsxs)("div",{className:l().searchContainer,children:[(0,n.jsx)(i.jRj,{className:l().searchIcon,"aria-hidden":!0}),(0,n.jsx)("input",{type:"search",className:l().searchInput,placeholder:"Search transactions…",value:J,onChange:t=>tv(t.target.value),"aria-label":"Search transactions"}),J&&(0,n.jsx)("button",{type:"button",className:l().searchClearButton,onClick:()=>tv(""),"aria-label":"Clear search",children:(0,n.jsx)(i.q5L,{"aria-hidden":!0})})]}),tx]})]}),0===x.length?(0,n.jsx)("div",{className:l().tableCard,"data-testid":"transactions-loading",children:(0,n.jsx)("div",{className:l().emptyState,children:(0,n.jsx)(_.Z,{message:"Refreshing data…"})})}):(0,n.jsx)(TransactionsTable,{tableScrollRef:$,transactions:tr,selectedIds:T,onSelectRow:(t,e)=>{g(a=>e?a.includes(t)?a:[...a,t]:a.filter(e=>e!==t))},onSelectAll:tl,selectionSummary:z,onOpenAdvanced:t=>{H(t)},onBulkDelete:t=>{console.info("Transactions bulk delete placeholder",t)},columnDefinitions:x,allColumns:ta,visibleColumns:tn,pagination:{pageSize:k,pageSizeOptions:b,currentPage:L,totalPages:Math.max(1,O.totalPages||1),onPageSizeChange:t=>{let e=b.includes(t)?t:b[0];R(e),P(1)},onPageChange:t=>{let e=Math.max(1,O.totalPages||1),a=Math.min(Math.max(t,1),e);P(a)}},isColumnReorderMode:!1,onColumnVisibilityChange:th,onColumnOrderChange:tT,sortState:I,onSortChange:td,isShowingSelectedOnly:B,isFetching:u})]}),(0,n.jsx)(transactions_TransactionAdvancedModal,{panelData:f,onClose:()=>{H(null)},onQuickEditSave:ty}),(0,n.jsx)(m.Z,{type:null!=D?D:"transaction",isOpen:tS,onClose:tm,onSubmit:tp}),(0,n.jsx)(y.Z,{context:"transactions",open:W,onClose:()=>q(!1),columns:tf,defaultColumns:tH,onChange:tg})]})}},4892:function(t){t.exports={root:"TxnTabs_root__5p_Mu",tabButton:"TxnTabs_tabButton__cow_d",tabLabel:"TxnTabs_tabLabel__Ro27Z",tabCount:"TxnTabs_tabCount__YxtJv"}},4539:function(t){t.exports={screen:"TransactionsHistory_screen__baLUC",controlsRegion:"TransactionsHistory_controlsRegion__WqApA",topBar:"TransactionsHistory_topBar__KQy5q",searchContainer:"TransactionsHistory_searchContainer__Y_k10",searchIcon:"TransactionsHistory_searchIcon__oaEaz",searchInput:"TransactionsHistory_searchInput__tg7lr",searchClearButton:"TransactionsHistory_searchClearButton__dggnO",filterActions:"TransactionsHistory_filterActions___3XMN",filterActionsQuickAdd:"TransactionsHistory_filterActionsQuickAdd__mf0Tm",selectionToolbar:"TransactionsHistory_selectionToolbar__0gycv",selectionCount:"TransactionsHistory_selectionCount___Jqij",selectionActions:"TransactionsHistory_selectionActions__ILouT",selectionActionButton:"TransactionsHistory_selectionActionButton__Irs_E",toolbarCard:"TransactionsHistory_toolbarCard__Ft5nj",toolbarLeft:"TransactionsHistory_toolbarLeft__ty8Ki",searchGroup:"TransactionsHistory_searchGroup__ogjGU",searchSubmitButton:"TransactionsHistory_searchSubmitButton__YwRyr",searchSubmitIcon:"TransactionsHistory_searchSubmitIcon__je9zS",searchSubmitText:"TransactionsHistory_searchSubmitText__7RsHp",addButtonText:"TransactionsHistory_addButtonText__UGmZo",customizeButtonText:"TransactionsHistory_customizeButtonText__76rpU",resetButtonText:"TransactionsHistory_resetButtonText__wXBph",searchInputActions:"TransactionsHistory_searchInputActions__T7eFK",searchIconButton:"TransactionsHistory_searchIconButton__o2fMa",searchRestoreButton:"TransactionsHistory_searchRestoreButton__WTPZP",iconButton:"TransactionsHistory_iconButton__P_KIS",toolbarIconButton:"TransactionsHistory_toolbarIconButton__Eav1O",restoreChip:"TransactionsHistory_restoreChip__wxZP0",filterButton:"TransactionsHistory_filterButton__eWuDI",filterButtonActive:"TransactionsHistory_filterButtonActive__JRdIW",countBadge:"TransactionsHistory_countBadge__lDCsH",primaryButton:"TransactionsHistory_primaryButton__6QKyL",iconPrimaryButton:"TransactionsHistory_iconPrimaryButton__CDtGL",srOnly:"TransactionsHistory_srOnly__2LGzz",customizeRow:"TransactionsHistory_customizeRow__UvjZJ",customizeCell:"TransactionsHistory_customizeCell__cypGw",customizeControls:"TransactionsHistory_customizeControls__3KAsv",customizeToolbarRow:"TransactionsHistory_customizeToolbarRow__DjT2x",customizeSelectAll:"TransactionsHistory_customizeSelectAll__NGiMa",customizeToolbarActions:"TransactionsHistory_customizeToolbarActions__PwR0q",customizeToggleGrid:"TransactionsHistory_customizeToggleGrid__70GsI",customizeToggleSpacer:"TransactionsHistory_customizeToggleSpacer__M2WnI",customizeToggle:"TransactionsHistory_customizeToggle__kbjMl",customizeToggleVisible:"TransactionsHistory_customizeToggleVisible__Zqo_v",customizeToggleHidden:"TransactionsHistory_customizeToggleHidden__wwSL3",customizeToggleLabel:"TransactionsHistory_customizeToggleLabel__JDU82",customizeToggleActions:"TransactionsHistory_customizeToggleActions__t_J1a",customizeNudgeButton:"TransactionsHistory_customizeNudgeButton__1O69A",actionsGroup:"TransactionsHistory_actionsGroup__5ePbZ",customizeActionsGroup:"TransactionsHistory_customizeActionsGroup__uYKD1",toolbarSearchRow:"TransactionsHistory_toolbarSearchRow__bEuT1",searchButtonGroup:"TransactionsHistory_searchButtonGroup__YDpao",toolbarCustomizeRow:"TransactionsHistory_toolbarCustomizeRow__YNz3r",customizeActionsCluster:"TransactionsHistory_customizeActionsCluster__J51Kt",toggleSwitch:"TransactionsHistory_toggleSwitch__EmQEn",toggleVisual:"TransactionsHistory_toggleVisual__W1TvD",toggleLabel:"TransactionsHistory_toggleLabel__McI_g",toolbarCustomizeControls:"TransactionsHistory_toolbarCustomizeControls__twujA",tableActionsGroup:"TransactionsHistory_tableActionsGroup__JDF_9",actionsEllipsis:"TransactionsHistory_actionsEllipsis__yshrx",tableActionIconButton:"TransactionsHistory_tableActionIconButton__QOwXs",tableDangerIconButton:"TransactionsHistory_tableDangerIconButton__rfksJ",advancedButton:"TransactionsHistory_advancedButton__ZJdxz",pageSizeGroup:"TransactionsHistory_pageSizeGroup__fyr3G",pageSizeSelect:"TransactionsHistory_pageSizeSelect__YmWRs",fontScaleGroup:"TransactionsHistory_fontScaleGroup___TT6Q",fontScaleLabel:"TransactionsHistory_fontScaleLabel__NoTE0",fontScaleButton:"TransactionsHistory_fontScaleButton__TXs3I",fontScaleButtonText:"TransactionsHistory_fontScaleButtonText__uJCcc",fontScaleValue:"TransactionsHistory_fontScaleValue__eOzU4",fontScaleReset:"TransactionsHistory_fontScaleReset__Ng6Rz",paginationControls:"TransactionsHistory_paginationControls__Loigg",paginationMeta:"TransactionsHistory_paginationMeta__bnI7O",fontScaleMeta:"TransactionsHistory_fontScaleMeta__siKyk",paginationButton:"TransactionsHistory_paginationButton__ABbUY",paginationButtonText:"TransactionsHistory_paginationButtonText__WxCg2",paginationStatus:"TransactionsHistory_paginationStatus__BtArC",tableFooter:"TransactionsHistory_tableFooter__xQ3P1",selectionBar:"TransactionsHistory_selectionBar__JP2ln",selectionSummaryText:"TransactionsHistory_selectionSummaryText___H3ox",selectionTotals:"TransactionsHistory_selectionTotals__2DOAp",selectionButtons:"TransactionsHistory_selectionButtons__JNS6j",modalOverlay:"TransactionsHistory_modalOverlay__cmTB_",modalContent:"TransactionsHistory_modalContent__xrbyn",fadeUp:"TransactionsHistory_fadeUp__9zLvh",modalHeader:"TransactionsHistory_modalHeader__uxnGT",modalTitle:"TransactionsHistory_modalTitle__rK37w",modalBody:"TransactionsHistory_modalBody__vyhTF",modalDescription:"TransactionsHistory_modalDescription__LQXPu",columnsOverlay:"TransactionsHistory_columnsOverlay__slHKc",columnsPopover:"TransactionsHistory_columnsPopover__iFim2",columnsHeader:"TransactionsHistory_columnsHeader__fG_W4",columnsSearchRow:"TransactionsHistory_columnsSearchRow__gTyn5",columnsSearchField:"TransactionsHistory_columnsSearchField__RMr3H",columnsSearchIcon:"TransactionsHistory_columnsSearchIcon___RiOR",columnsSearchInput:"TransactionsHistory_columnsSearchInput__uv3h6",columnsListWrap:"TransactionsHistory_columnsListWrap__nAyJV",columnsList:"TransactionsHistory_columnsList__ff7G4",dropIndicatorPulse:"TransactionsHistory_dropIndicatorPulse__qDfy9",columnRow:"TransactionsHistory_columnRow__AvJmp",columnRowDragging:"TransactionsHistory_columnRowDragging__Hrkv8",columnRowPreview:"TransactionsHistory_columnRowPreview__ZBjll",columnDragHandle:"TransactionsHistory_columnDragHandle__PfkCw",columnMainControls:"TransactionsHistory_columnMainControls__we_bb",columnLabel:"TransactionsHistory_columnLabel__CLYE5",columnCheckbox:"TransactionsHistory_columnCheckbox__jQx1_",columnFormatGroup:"TransactionsHistory_columnFormatGroup__eR5Db",columnFormatControl:"TransactionsHistory_columnFormatControl__eHbvP",columnFormatLabel:"TransactionsHistory_columnFormatLabel__p9GsN",columnFormatSelect:"TransactionsHistory_columnFormatSelect__9_jnB",columnFormatInput:"TransactionsHistory_columnFormatInput__G_1vE",columnWidthGroup:"TransactionsHistory_columnWidthGroup__ejlmA",columnWidthValue:"TransactionsHistory_columnWidthValue__IZSsM",columnWidthSlider:"TransactionsHistory_columnWidthSlider__JmvQy",columnsFooter:"TransactionsHistory_columnsFooter__sJVb1",modalField:"TransactionsHistory_modalField__ShItI",modalDropdown:"TransactionsHistory_modalDropdown__YwpLf",modalDropdownTrigger:"TransactionsHistory_modalDropdownTrigger__HmBOV",modalDropdownLabelGroup:"TransactionsHistory_modalDropdownLabelGroup__uOY4I",modalDropdownValue:"TransactionsHistory_modalDropdownValue__Hvjff",modalDropdownChevron:"TransactionsHistory_modalDropdownChevron__ktMI6",modalDropdownContent:"TransactionsHistory_modalDropdownContent__7TY0i",modalSimpleList:"TransactionsHistory_modalSimpleList__QwBy5",modalSearchGroup:"TransactionsHistory_modalSearchGroup__WHH0P",modalPicker:"TransactionsHistory_modalPicker__2x1Rx",modalPickerSearch:"TransactionsHistory_modalPickerSearch__628_O",modalOptionList:"TransactionsHistory_modalOptionList__N7G63",modalOptionButton:"TransactionsHistory_modalOptionButton__8_6oX",modalOptionButtonActive:"TransactionsHistory_modalOptionButtonActive__Pdul2",modalSearchIcon:"TransactionsHistory_modalSearchIcon__sDdQ0",modalSearchInput:"TransactionsHistory_modalSearchInput__4Epk_",modalLabel:"TransactionsHistory_modalLabel__Pg2dM",modalControl:"TransactionsHistory_modalControl__ir_BR",tagList:"TransactionsHistory_tagList__FeMQa",tagOption:"TransactionsHistory_tagOption__4t7r0",tagOptionActive:"TransactionsHistory_tagOptionActive__Ojl32",emptyOption:"TransactionsHistory_emptyOption__8gygI",modalFooter:"TransactionsHistory_modalFooter__s5ZVp",secondaryButton:"TransactionsHistory_secondaryButton__OMUuB",clearFilterButton:"TransactionsHistory_clearFilterButton__6BsT0",modalApply:"TransactionsHistory_modalApply__MBFH3",advancedOverlay:"TransactionsHistory_advancedOverlay__ejxR1",advancedPanel:"TransactionsHistory_advancedPanel__RtNEG",advancedTextarea:"TransactionsHistory_advancedTextarea__Pzj1Q",advancedError:"TransactionsHistory_advancedError__DONGF",advancedHeader:"TransactionsHistory_advancedHeader__RhcSZ",advancedTitle:"TransactionsHistory_advancedTitle__AAPor",advancedSection:"TransactionsHistory_advancedSection__AT8Ld",advancedLabel:"TransactionsHistory_advancedLabel__qJtLn",advancedValue:"TransactionsHistory_advancedValue__M2hqq",metricsGrid:"TransactionsHistory_metricsGrid__ivkW8",metricTile:"TransactionsHistory_metricTile__5Z5d_",metricLabel:"TransactionsHistory_metricLabel__36_0R",metricValue:"TransactionsHistory_metricValue__HdfDG",wrap:"TransactionsHistory_wrap__UkB8s",confirmOverlay:"TransactionsHistory_confirmOverlay__iL8QE",confirmDialog:"TransactionsHistory_confirmDialog__NIcwq",confirmMessage:"TransactionsHistory_confirmMessage__QmYWw",confirmActions:"TransactionsHistory_confirmActions__oictr",triggerIcon:"TransactionsHistory_triggerIcon__IHm3Q",paginationBar:"TransactionsHistory_paginationBar__KvcY_",selectionQuickActions:"TransactionsHistory_selectionQuickActions__Aee4e"}}},function(t){t.O(0,[285,45,901,568,958,774,888,179],function(){return t(t.s=3978)}),_N_E=t.O()}]);