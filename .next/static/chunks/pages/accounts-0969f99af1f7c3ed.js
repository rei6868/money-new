(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[778],{1091:function(t,e,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/accounts",function(){return a(3498)}])},3498:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return AccountsPage}});var n=a(5893),o=a(7294),c=a(2568),l=a(7871),s=a(8305),i=a.n(s),u=a(3692);let r=[{id:"expense",icon:u.OeJ,label:"Log expense"},{id:"income",icon:u.UJB,label:"Log income"},{id:"transfer",icon:u.yG,label:"Transfer"},{id:"loan",icon:u.Bw1,label:"Loan or repay"}];var accounts_AccountsQuickActions=function(t){let{account:e,onAction:a,disabled:c=!0,className:l=i().cardQuickActions,buttonClassName:s=i().quickActionButton}=t,u=(0,o.useMemo)(()=>"function"==typeof a&&!c,[a,c]);return(0,n.jsx)("div",{className:l,children:r.map(t=>{let o=t.icon;return(0,n.jsxs)("button",{type:"button",className:s,onClick:n=>{n.preventDefault(),u&&a&&a(t.id,e)},disabled:!u,title:u?t.label:"".concat(t.label," (coming soon)"),children:[(0,n.jsx)(o,{"aria-hidden":!0}),(0,n.jsx)("span",{className:i().quickDockLabel,children:t.label})]},t.id)})})};function getStatusClass(t){let e=String(null!=t?t:"").toLowerCase();return"active"===e?i().statusActive:"pending"===e||"pending-activation"===e?i().statusPending:"void"===e||"canceled"===e||"closed"===e||"archived"===e?i().statusInactive:i().statusNeutral}function renderBalanceCell(t){let e=(0,l.Bo)(t);return(0,n.jsxs)("strong",{children:["$",e]})}let optionalColumn=t=>({...t,optional:!0,defaultVisible:!1}),d=[{id:"accountName",label:"Account",minWidth:220,defaultWidth:240,renderCell:function(t){var e,a;return(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{children:null!==(e=t.accountName)&&void 0!==e?e:"—"}),(0,n.jsx)("div",{className:i().columnSubline,children:null!==(a=t.accountType)&&void 0!==a?a:"—"})]})}},{id:"accountType",label:"Type",minWidth:150,defaultWidth:180,valueAccessor:t=>{var e;return null!==(e=t.accountType)&&void 0!==e?e:"—"}},{id:"currentBalance",label:"Current Balance",minWidth:180,defaultWidth:200,align:"right",valueAccessor:t=>renderBalanceCell(t.currentBalance)},{id:"status",label:"Status",minWidth:140,defaultWidth:160,renderCell:function(t){var e;let a=null!==(e=t.status)&&void 0!==e?e:"--",o="".concat(i().statusBadge," ").concat(getStatusClass(a)).trim();return(0,n.jsx)("span",{className:o,children:a||"--"})}},optionalColumn({id:"openingBalance",label:"Opening Balance",minWidth:180,defaultWidth:200,align:"right",valueAccessor:t=>renderBalanceCell(t.openingBalance)}),optionalColumn({id:"totalIn",label:"Total In",minWidth:170,defaultWidth:190,align:"right",valueAccessor:t=>renderBalanceCell(t.totalIn)}),optionalColumn({id:"totalOut",label:"Total Out",minWidth:170,defaultWidth:190,align:"right",valueAccessor:t=>renderBalanceCell(t.totalOut)}),optionalColumn({id:"parentAccountId",label:"Parent Account",minWidth:200,defaultWidth:220,valueAccessor:t=>{var e;return null!==(e=t.parentAccountId)&&void 0!==e?e:"—"}})];function createDefaultColumnState(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;return t.map((t,e)=>{let a=Number.isFinite(t.minWidth)?t.minWidth:160,n=Number.isFinite(t.defaultWidth)?t.defaultWidth:a;return{id:t.id,width:Math.max(n,a),visible:!1!==t.defaultVisible,order:e,optional:!!t.optional}})}let _={accountName:t=>t.accountName.toLowerCase(),accountType:t=>t.accountType.toLowerCase(),currentBalance:t=>t.currentBalance,openingBalance:t=>t.openingBalance,totalIn:t=>t.totalIn,totalOut:t=>t.totalOut,status:t=>{var e;return(null!==(e=t.status)&&void 0!==e?e:"").toLowerCase()},parentAccountId:t=>{var e;return(null!==(e=t.parentAccountId)&&void 0!==e?e:"").toLowerCase()}};var accounts_AccountsCardsView=function(t){let{accounts:e,onQuickAction:a}=t;return e&&0!==e.length?(0,n.jsx)("div",{className:i().cardsGrid,children:e.map(t=>{var e,o,c,s;let u=null!==(c=t.status)&&void 0!==c?c:"inactive",r="".concat(i().statusBadge," ").concat(getStatusClass(u)).trim(),d=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"linear-gradient(135deg, #4959c5, #7f8fe6)";if(!t)return e;try{let e=new URL(t,t.startsWith("http")?void 0:"https://res.cloudinary.com/");if(!e.pathname.includes("/image/upload/"))return"url(".concat(e.toString(),")");let a=e.pathname.split("/"),n=a.findIndex(t=>"upload"===t);if(-1!==n){let t=a[n+1];t&&""!==t?t.includes("f_auto")||(a[n+1]="f_auto,q_auto,".concat(t)):a.splice(n+1,0,"f_auto,q_auto"),e.pathname=a.join("/")}return"url(".concat(e.toString(),")")}catch(e){return"url(".concat(t,")")}}(t.imgUrl);return(0,n.jsxs)("article",{className:i().accountCard,children:[(0,n.jsxs)("div",{className:i().cardMedia,style:{backgroundImage:d},children:[(0,n.jsx)("span",{className:i().cardOverlay,"aria-hidden":!0}),(0,n.jsxs)("div",{className:i().cardContent,children:[(0,n.jsx)("h3",{className:i().cardTitle,children:null!==(e=t.accountName)&&void 0!==e?e:"Unnamed account"}),(0,n.jsx)("div",{className:i().cardMeta,children:(0,n.jsx)("span",{children:null!==(o=t.accountType)&&void 0!==o?o:"Unknown type"})}),(0,n.jsx)("div",{className:i().cardBalance,children:"$".concat((0,l.Bo)(null!==(s=t.currentBalance)&&void 0!==s?s:0))})]})]}),(0,n.jsxs)("footer",{className:i().cardFooter,children:[(0,n.jsx)("span",{className:r,children:u}),(0,n.jsx)(accounts_AccountsQuickActions,{account:t,onAction:a,disabled:!a})]})]},t.accountId)})}):(0,n.jsx)("div",{className:i().cardsEmpty,children:"No accounts available yet. Connect a bank, wallet, or add an offline account to see it appear here."})},p=a(9890),m=a.n(p);let h={all:"default",bank:"indigo",credit:"danger",saving:"teal",invest:"orange","e-wallet":"purple",group:"blue",loan:"amber",mortgage:"rose",cash:"success",other:"gray"};var accounts_AccountTypeTabs=function(t){let{activeTab:e,onTabChange:a,tabs:o}=t;return(0,n.jsx)("div",{className:m().root,role:"tablist","aria-label":"Account type filters",children:o.map(t=>{let o=h[t.id.toLowerCase()]||"default",c=t.id===e;return(0,n.jsxs)("button",{type:"button",className:m().tabButton,"data-active":c?"true":"false","data-color":o,onClick:()=>a(t.id),role:"tab","aria-selected":c,children:[(0,n.jsx)("span",{className:m().tabLabel,children:t.label}),(0,n.jsx)("span",{className:m().tabCount,children:t.count})]},t.id)})})},b=a(5832);let v={count:0,amount:0},g=b.W8;var accounts_TableAccounts=function(t){var e;let{tableScrollRef:a,accounts:c,selectedIds:l,onSelectRow:s,onSelectAll:r,selectionSummary:d,pagination:_,columnDefinitions:p,allColumns:m,visibleColumns:h,isColumnReorderMode:b=!1,onColumnVisibilityChange:f,onColumnOrderChange:y,sortState:S,onSortChange:C,isFetching:x=!1,isShowingSelectedOnly:N=!1,onEditAccount:B}=t,[T,j]=(0,o.useState)(1),A=(0,o.useCallback)(t=>{j(e=>{let a="function"==typeof t?t(e):t;return Math.round(100*Math.min(1.35,Math.max(.85,a)))/100})},[]),w=(e={fontScale:T,onDecrease:()=>A(t=>t-.1),onIncrease:()=>A(t=>t+.1),onReset:()=>A(1)},(0,o.useMemo)(()=>{let{fontScale:t,onIncrease:a,onDecrease:o,onReset:c}=e,l=t<1.35-.001,s=t>.851,r=.001>Math.abs(t-1),d="".concat(Math.round(100*t),"%");return{render:t=>(0,n.jsxs)(n.Fragment,{children:[t.selectedCount>0?(0,n.jsxs)("span",{className:i().selectionCount,children:[t.selectedCount," selected"]}):null,(0,n.jsxs)("div",{className:i().paginationControls,role:"group","aria-label":"Accounts table pagination",children:[(0,n.jsxs)("button",{type:"button",className:i().paginationButton,onClick:()=>_.onPageChange(_.currentPage-1),disabled:1===_.currentPage,"aria-label":"Previous page",children:[(0,n.jsx)(u.YFh,{"aria-hidden":!0}),(0,n.jsx)("span",{className:i().paginationButtonText,children:"Prev"})]}),(0,n.jsxs)("button",{type:"button",className:i().fontScaleButton,onClick:o,disabled:!s,"aria-label":"Decrease table font size",children:[(0,n.jsx)(u.ego,{"aria-hidden":!0}),(0,n.jsx)("span",{className:i().fontScaleButtonText,children:"-"})]}),(0,n.jsxs)("div",{className:i().pageSizeGroup,children:[(0,n.jsx)("label",{htmlFor:"accounts-page-size",children:"Rows per page"}),(0,n.jsx)("select",{id:"accounts-page-size",className:i().pageSizeSelect,value:_.pageSize,onChange:t=>_.onPageSizeChange(Number(t.target.value)),children:_.pageSizeOptions.map(t=>(0,n.jsx)("option",{value:t,children:t},t))})]}),(0,n.jsxs)("button",{type:"button",className:"".concat(i().fontScaleButton," ").concat(i().fontScaleReset).trim(),onClick:c,disabled:r,"aria-label":"Reset table font size",children:[(0,n.jsx)(u.Bw1,{"aria-hidden":!0}),(0,n.jsx)("span",{className:i().fontScaleButtonText,children:"Reset"})]}),(0,n.jsxs)("button",{type:"button",className:i().fontScaleButton,onClick:a,disabled:!l,"aria-label":"Increase table font size",children:[(0,n.jsx)(u.OvN,{"aria-hidden":!0}),(0,n.jsx)("span",{className:i().fontScaleButtonText,children:"+"})]}),(0,n.jsxs)("button",{type:"button",className:i().paginationButton,onClick:()=>_.onPageChange(_.currentPage+1),disabled:_.currentPage===_.totalPages,"aria-label":"Next page",children:[(0,n.jsx)(u.Tfp,{"aria-hidden":!0}),(0,n.jsx)("span",{className:i().paginationButtonText,children:"Next"})]})]}),(0,n.jsxs)("div",{className:i().paginationMeta,children:[(0,n.jsxs)("div",{className:i().fontScaleMeta,children:[(0,n.jsx)("span",{className:i().fontScaleLabel,children:"Font size"}),(0,n.jsx)("span",{className:i().fontScaleValue,"aria-live":"polite",children:d})]}),(0,n.jsxs)("span",{className:i().paginationStatus,children:["Page ",_.currentPage," of ",_.totalPages]})]})]})}},[e,_]));return(0,n.jsx)(g,{tableScrollRef:a,transactions:c,selectedIds:l,onSelectRow:s,onSelectAll:r,selectionSummary:null!=d?d:v,columnDefinitions:p,allColumns:m,visibleColumns:h,pagination:w,isColumnReorderMode:b,onColumnVisibilityChange:f,onColumnOrderChange:y,fontScale:T,sortState:S,onSortChange:C,isShowingSelectedOnly:N,isFetching:x,rowIdAccessor:t=>t.accountId,onEditRow:B,onBulkDelete:t=>{console.info("Accounts bulk delete placeholder",t)}})},f=a(1420),y=a.n(f);let S=[{value:"cash",label:"Cash"},{value:"bank",label:"Bank"},{value:"credit",label:"Credit"},{value:"investment",label:"Investment"},{value:"other",label:"Other"}],C=[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"archived",label:"Archived"}];var accounts_AccountEditModal=function(t){var e,a,c,l;let{account:s,isOpen:i,onClose:r,onSubmit:d}=t,[_,p]=(0,o.useState)(""),[m,h]=(0,o.useState)(null!==(c=null===(e=S[0])||void 0===e?void 0:e.value)&&void 0!==c?c:"cash"),[b,v]=(0,o.useState)(null!==(l=null===(a=C[0])||void 0===a?void 0:a.value)&&void 0!==l?l:"active"),[g,f]=(0,o.useState)("0"),[x,N]=(0,o.useState)(""),[B,T]=(0,o.useState)(!1),j=(0,o.useMemo)(()=>{var t;return s?"Edit ".concat(null!==(t=s.accountName)&&void 0!==t?t:"account"):"Edit account"},[s]);if((0,o.useEffect)(()=>{var t,e,a,n,o,c,l,u,r,d,_;if(!i){T(!1);return}let m=null===(t=S.find(t=>t.value===(null==s?void 0:s.accountType)))||void 0===t?void 0:t.value,b=null===(e=C.find(t=>t.value===(null==s?void 0:s.status)))||void 0===e?void 0:e.value;p(null!==(o=null==s?void 0:s.accountName)&&void 0!==o?o:""),h(null!=m?m:null!==(l=null!==(c=null==s?void 0:s.accountType)&&void 0!==c?c:null===(a=S[0])||void 0===a?void 0:a.value)&&void 0!==l?l:"cash"),v(null!=b?b:null!==(r=null!==(u=null==s?void 0:s.status)&&void 0!==u?u:null===(n=C[0])||void 0===n?void 0:n.value)&&void 0!==r?r:"active"),f(String(null!==(d=null==s?void 0:s.openingBalance)&&void 0!==d?d:0)),N(null!==(_=null==s?void 0:s.notes)&&void 0!==_?_:"")},[s,i]),(0,o.useEffect)(()=>{if(!i||"undefined"==typeof document)return;let t=document.body.style.overflow;document.body.style.overflow="hidden";let e=window.setTimeout(()=>{let t=document.querySelector("#account-edit-name");null==t||t.focus({preventScroll:!0})},20);return()=>{window.clearTimeout(e),document.body.style.overflow=t}},[i]),!i||!s)return null;let handleSubmit=async t=>{if(t.preventDefault(),!B){T(!0);try{let t={accountId:s.accountId,accountName:_.trim()||s.accountName,accountType:m,status:b,notes:x.trim(),openingBalance:Number.parseFloat(g)||0};await (null==d?void 0:d(t)),r()}finally{T(!1)}}};return(0,n.jsx)("div",{className:y().overlay,role:"presentation",onClick:t=>{t.target!==t.currentTarget||B||r()},children:(0,n.jsxs)("div",{className:y().dialog,role:"dialog","aria-modal":"true","aria-label":j,children:[(0,n.jsxs)("div",{className:y().header,children:[(0,n.jsx)("h2",{className:y().title,children:j}),(0,n.jsx)("button",{type:"button",className:y().closeButton,onClick:r,"aria-label":"Close edit account modal",disabled:B,children:(0,n.jsx)(u.q5L,{"aria-hidden":!0})})]}),(0,n.jsxs)("form",{className:y().content,onSubmit:handleSubmit,children:[(0,n.jsxs)("label",{className:y().field,htmlFor:"account-edit-name",children:[(0,n.jsx)("span",{className:y().fieldLabel,children:"Account name"}),(0,n.jsx)("input",{id:"account-edit-name",className:y().input,value:_,onChange:t=>p(t.target.value),required:!0,disabled:B})]}),(0,n.jsxs)("label",{className:y().field,htmlFor:"account-edit-type",children:[(0,n.jsx)("span",{className:y().fieldLabel,children:"Account type"}),(0,n.jsx)("select",{id:"account-edit-type",className:y().input,value:m,onChange:t=>h(t.target.value),disabled:B,children:S.map(t=>(0,n.jsx)("option",{value:t.value,children:t.label},t.value))})]}),(0,n.jsxs)("label",{className:y().field,htmlFor:"account-edit-status",children:[(0,n.jsx)("span",{className:y().fieldLabel,children:"Status"}),(0,n.jsx)("select",{id:"account-edit-status",className:y().input,value:b,onChange:t=>v(t.target.value),disabled:B,children:C.map(t=>(0,n.jsx)("option",{value:t.value,children:t.label},t.value))})]}),(0,n.jsxs)("label",{className:y().field,htmlFor:"account-edit-opening",children:[(0,n.jsx)("span",{className:y().fieldLabel,children:"Opening balance"}),(0,n.jsx)("input",{id:"account-edit-opening",className:y().input,type:"number",min:"0",step:"0.01",value:g,onChange:t=>f(t.target.value),disabled:B})]}),(0,n.jsxs)("label",{className:y().field,htmlFor:"account-edit-notes",children:[(0,n.jsx)("span",{className:y().fieldLabel,children:"Notes"}),(0,n.jsx)("textarea",{id:"account-edit-notes",className:y().textarea,value:x,onChange:t=>N(t.target.value),rows:3,disabled:B})]}),(0,n.jsxs)("div",{className:y().footer,children:[(0,n.jsx)("button",{type:"button",className:y().secondaryButton,onClick:r,disabled:B,children:"Cancel"}),(0,n.jsx)("button",{type:"submit",className:y().primaryButton,disabled:B,children:B?"Saving…":"Save changes"})]})]})]})})},x=a(7050),N=a(2015),B=a(3735),T=a(8350),j=a(477),A=a(3789);let w=[5,10,20,30];function parseNumber(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(null==t)return e;let a=Number(t);return Number.isFinite(a)?a:e}function AccountsPage(){var t;let{isAuthenticated:e,isLoading:a}=(0,T.Q)(),{accounts:l,refetch:s,createAccount:r}=(0,j.x)(),[p,m]=(0,o.useState)([]),[h,b]=(0,o.useState)(!1),[v,g]=(0,o.useState)(null),[f,y]=(0,o.useState)([]),[S,C]=(0,o.useState)(!1),[k,I]=(0,o.useState)(()=>createDefaultColumnState(d).map(t=>({...t,pinned:null}))),[M]=(0,o.useState)(()=>createDefaultColumnState(d).map(t=>({...t,pinned:null}))),[H,L]=(0,o.useState)(null!==(t=w[1])&&void 0!==t?t:w[0]),[z,O]=(0,o.useState)(1),[P,E]=(0,o.useState)({columnId:"accountName",direction:"asc"}),[G,R]=(0,o.useState)("table"),[F,W]=(0,o.useState)(()=>localStorage.getItem("accountsTypeFilter")||"all"),[U,D]=(0,o.useState)(null),[Q,q]=(0,o.useState)(null),[V,K]=(0,o.useState)(!1),[X,Y]=(0,o.useState)(""),[Z,J]=(0,o.useState)(null),[$,tt]=(0,o.useState)([]),te=(0,o.useRef)(null);(0,o.useEffect)(()=>{localStorage.setItem("accountsTypeFilter",F)},[F]);let ta=(0,o.useMemo)(()=>new Map(d.map(t=>[t.id,t])),[]),tn=(0,o.useMemo)(()=>new Set(d.map(t=>t.id)),[]),to=(0,o.useCallback)(t=>{var e,a;let n=ta.get(t);if(!n)return 200;let o=null!==(e=n.minWidth)&&void 0!==e?e:160,c=null!==(a=n.defaultWidth)&&void 0!==a?a:o;return Math.max(c,o)},[ta]),tc=(0,o.useMemo)(()=>{if(0===k.length)return[];let t=k.slice().sort((t,e)=>t.order-e.order),e=t.filter(t=>"left"===t.pinned),a=t.filter(t=>"right"===t.pinned),n=t.filter(t=>"left"!==t.pinned&&"right"!==t.pinned),o=[...e,...n,...a];return o.map((t,e)=>{var a,n,o,c,l,s;let i=ta.get(t.id),u=null!==(a=null==i?void 0:i.minWidth)&&void 0!==a?a:160,r=(null==i?void 0:i.defaultVisible)!==!1,d=Math.max(null!==(o=null!==(n=t.width)&&void 0!==n?n:null==i?void 0:i.defaultWidth)&&void 0!==o?o:u,u);return{...t,order:e,width:d,visible:null!==(c=t.visible)&&void 0!==c?c:r,optional:!!(null!==(l=t.optional)&&void 0!==l?l:null==i?void 0:i.optional),pinned:null!==(s=t.pinned)&&void 0!==s?s:null}})},[k,ta]),tl=(0,o.useMemo)(()=>tc.filter(t=>!1!==t.visible),[tc]);(0,o.useMemo)(()=>tc.every(t=>!1!==t.visible),[tc]),(0,o.useMemo)(()=>{let t=tc.filter(t=>t.optional);return 0!==t.length&&t.every(t=>!1!==t.visible)},[tc]);let ts=(0,o.useMemo)(()=>{let t=k.slice().sort((t,e)=>t.order-e.order);return t.map(t=>{var e,a;let n=ta.get(t.id);return{id:t.id,label:null!==(e=null==n?void 0:n.label)&&void 0!==e?e:t.id,visible:!1!==t.visible,pinned:null!==(a=t.pinned)&&void 0!==a?a:null,locked:"accountName"===t.id,mandatory:"accountName"===t.id}})},[k,ta]),ti=(0,o.useMemo)(()=>{if(!M||0===M.length)return ts;let t=M.slice().sort((t,e)=>t.order-e.order);return t.map(t=>{var e,a;let n=ta.get(t.id);return{id:t.id,label:null!==(e=null==n?void 0:n.label)&&void 0!==e?e:t.id,visible:!1!==t.visible,pinned:null!==(a=t.pinned)&&void 0!==a?a:null,locked:"accountName"===t.id,mandatory:"accountName"===t.id}})},[M,ta,ts]);(0,o.useEffect)(()=>{let t=l.map(t=>(function(t){var e,a,n,o,c,l,s,i,u,r,d,_,p,m,h,b;let v=null!==(a=null!==(e=t.accountId)&&void 0!==e?e:t.account_id)&&void 0!==a?a:null;return v?{accountId:v,accountName:null!==(o=null!==(n=t.accountName)&&void 0!==n?n:t.account_name)&&void 0!==o?o:"Unnamed account",accountType:null!==(l=null!==(c=t.accountType)&&void 0!==c?c:t.account_type)&&void 0!==l?l:"other",openingBalance:parseNumber(null!==(s=t.openingBalance)&&void 0!==s?s:t.opening_balance),currentBalance:parseNumber(null!==(i=t.currentBalance)&&void 0!==i?i:t.current_balance),totalIn:parseNumber(null!==(u=t.totalIn)&&void 0!==u?u:t.total_in),totalOut:parseNumber(null!==(r=t.totalOut)&&void 0!==r?r:t.total_out),status:null!==(d=t.status)&&void 0!==d?d:"inactive",notes:null!==(_=t.notes)&&void 0!==_?_:"",parentAccountId:null!==(m=null!==(p=t.parentAccountId)&&void 0!==p?p:t.parent_account_id)&&void 0!==m?m:null,imgUrl:null!==(b=null!==(h=t.imgUrl)&&void 0!==h?h:t.img_url)&&void 0!==b?b:null,raw:t}:null})(t)).filter(t=>!!t);m(t)},[l]),(0,o.useEffect)(()=>{if(!e)return;let t=!1;return fetch("/api/accounts/types").then(t=>{if(!t.ok)throw Error("Failed to fetch account types");return t.json()}).then(e=>{if(t)return;let a=Array.isArray(null==e?void 0:e.types)?e.types:[],n=Array.from(new Set(a.filter(t=>"string"==typeof t).map(t=>t.trim()).filter(t=>t.length>0)));tt(n)}).catch(e=>{t||console.error(e)}),()=>{t=!0}},[e]),(0,o.useEffect)(()=>{if(0===f.length){C(!1);return}let t=new Set(p.map(t=>t.accountId));y(e=>e.filter(e=>t.has(e)))},[p,f.length]);let tu=(0,o.useMemo)(()=>(function(t,e,a){if(!e||!a)return t.slice();let n=_[e];if(!n)return t.slice();let o="desc"===a?-1:1;return t.slice().sort((t,e)=>{let a=n(t),c=n(e);if("number"==typeof a&&"number"==typeof c)return(a-c)*o;let l=String(null!=a?a:"").toLowerCase(),s=String(null!=c?c:"").toLowerCase();return l===s?0:l>s?o:-o})})(p,P.columnId,P.direction),[p,P]),tr=(0,o.useMemo)(()=>{let t=X.trim().toLowerCase();return tu.filter(e=>{if("all"!==F&&e.accountType!==F)return!1;if(!t)return!0;let a=[e.accountName,e.accountType,e.status,e.notes,e.accountId];return a.some(e=>"string"==typeof e&&e.toLowerCase().includes(t))})},[X,tu,F]),td=(0,o.useMemo)(()=>0===tr.length?1:Math.max(1,Math.ceil(tr.length/H)),[tr.length,H]);(0,o.useEffect)(()=>{z>td&&O(td)},[z,td]);let t_=(0,o.useMemo)(()=>{if("cards"===G)return tr;let t=(z-1)*H,e=t+H;return tr.slice(t,e)},[tr,z,H,G]),tp=(0,o.useMemo)(()=>new Set(f),[f]),tm=(0,o.useMemo)(()=>S?t_.filter(t=>tp.has(t.accountId)):t_,[t_,S,tp]),th=(0,o.useMemo)(()=>{if(0===f.length)return{count:0,amount:0,totalBack:0,finalPrice:0};let t=new Set(f),e=p.reduce((e,a)=>{if(t.has(a.accountId)){var n;return e+(null!==(n=a.currentBalance)&&void 0!==n?n:0)}return e},0);return{count:t.size,amount:e,totalBack:0,finalPrice:0}},[p,f]),tb=(0,o.useCallback)((t,e)=>{y(a=>e?a.includes(t)?a:[...a,t]:a.filter(e=>e!==t))},[]),tv=(0,o.useCallback)(t=>{if(!t){y([]);return}let e=S?tm:t_;y(t=>{let a=new Set(t);return e.forEach(t=>a.add(t.accountId)),Array.from(a)})},[tm,t_,S]),tg=(0,o.useCallback)((t,e)=>{I(a=>a.map(a=>a.id===t?{...a,visible:!!e}:a))},[]),tf=(0,o.useCallback)(t=>{I(e=>{if(!Array.isArray(t)||0===t.length)return e;let a=new Map(t.map((t,e)=>[t,e])),n=e.slice(),o=n.filter(t=>a.has(t.id)),c=n.filter(t=>!a.has(t.id));o.sort((t,e)=>{var n,o;return(null!==(n=a.get(t.id))&&void 0!==n?n:0)-(null!==(o=a.get(e.id))&&void 0!==o?o:0)});let l=[...o,...c];return l.map((t,e)=>({...t,order:e}))})},[]),ty=(0,o.useCallback)((t,e)=>{if(!t||!e){E({columnId:null,direction:null});return}E({columnId:t,direction:e})},[]),tS=(0,o.useMemo)(()=>({pageSize:H,pageSizeOptions:w,currentPage:z,totalPages:td,onPageSizeChange:t=>{let e=w.includes(t)?t:w[0];L(e),O(1)},onPageChange:t=>{let e=Math.min(Math.max(t,1),td);O(e)}}),[z,H,td]),tC=(0,o.useCallback)(()=>{s()},[s]),tx=(0,o.useMemo)(()=>{let t=X.trim().toLowerCase(),e=tu.filter(e=>{if(!t)return!0;let a=[e.accountName,e.accountType,e.status,e.notes,e.accountId];return a.some(e=>"string"==typeof e&&e.toLowerCase().includes(t))}),a=new Map;e.forEach(t=>{let e=t.accountType;a.set(e,(a.get(e)||0)+1)});let n=Array.from(new Set(tu.map(t=>t.accountType))).sort(),o=[{id:"all",label:"All",count:e.length},...n.map(t=>({id:t,label:(0,A.VC)(t),count:a.get(t)||0}))];return o},[X,tu]),tN=(0,o.useCallback)((t,e)=>{q(e),D("transaction")},[]),tB=(0,o.useCallback)(t=>{I(e=>{let a=new Map(e.map(t=>[t.id,t.width])),n=new Map(e.map(t=>[t.id,t.optional])),o=[];return t.forEach((t,e)=>{var c,l,s;if(!tn.has(t.id))return;let i=t.id;o.push({id:i,width:null!==(c=a.get(i))&&void 0!==c?c:to(i),visible:t.visible,order:e,pinned:null!==(l=t.pinned)&&void 0!==l?l:null,optional:null!==(s=n.get(i))&&void 0!==s&&s})}),o})},[to,tn]),tT=(0,o.useCallback)(t=>{Y(t)},[]),tj=(0,o.useCallback)(()=>{q(null),D("account")},[]),tA=(0,o.useCallback)(()=>{D(null),q(null)},[]),tw=(0,o.useCallback)(async(t,e)=>{try{if("account"===t){let t={accountName:String(e.accountName||""),accountType:String(e.accountType||"other"),ownerId:String(e.ownerId||""),openingBalance:Number(e.openingBalance||0),currentBalance:Number(e.currentBalance||0),status:String(e.status||"active"),notes:e.notes?String(e.notes):void 0},a=await r(t);if(!a)throw Error("Failed to create account");console.info("Account created successfully",a)}else"transaction"===t?console.info("Transaction quick add placeholder",{action:Q,payload:e}):"person"===t&&console.info("Person creation placeholder",e)}catch(t){console.error("Failed to submit add modal",t),alert(t instanceof Error?t.message:"Failed to save")}},[r,Q]),tk=(0,o.useCallback)(t=>{var e;if(!t)return;let a=p.find(e=>e.accountId===t.accountId),n={...t,raw:null!==(e=t.raw)&&void 0!==e?e:{...t}};J(null!=a?a:n)},[p]),tI=(0,o.useCallback)(()=>{J(null)},[]),tM=(0,o.useCallback)(async t=>{m(e=>e.map(e=>e.accountId===t.accountId?{...e,accountName:t.accountName,accountType:t.accountType,status:t.status,notes:t.notes,openingBalance:t.openingBalance}:e)),console.info("Account edit placeholder",t)},[]),tH=(0,n.jsxs)("div",{className:i().filterActions,children:[(0,n.jsxs)("button",{type:"button",className:i().primaryButton,onClick:tj,disabled:h,"aria-label":"Add account",children:[(0,n.jsx)(u.OvN,{"aria-hidden":!0}),(0,n.jsx)("span",{children:"Add account"})]}),(0,n.jsx)(N.Z,{context:"accounts",onSelect:tN,disabled:h,triggerLabel:"Quick add",triggerAriaLabel:"Open quick add actions",className:i().filterActionsQuickAdd}),(0,n.jsxs)("button",{type:"button",className:i().secondaryButton,onClick:()=>K(!0),"aria-label":"Customize columns",children:[(0,n.jsx)(u.nbt,{"aria-hidden":!0}),(0,n.jsx)("span",{children:"Customize"})]})]});return a||!e?null:(0,n.jsxs)(c.Z,{title:"Accounts",subtitle:"",children:[(0,n.jsxs)("div",{className:i().pageShell,children:[(0,n.jsxs)("div",{className:i().pageContent,children:[(0,n.jsxs)("div",{className:i().unifiedTopBar,children:[(0,n.jsx)("div",{className:i().headerTabGroup,role:"tablist","aria-label":"Accounts view mode",children:(0,n.jsxs)("div",{className:i().viewTabs,children:[(0,n.jsx)("span",{className:i().tabIndicator,"data-position":"cards"===G?"cards":"table","aria-hidden":!0}),(0,n.jsx)("button",{type:"button",className:i().tabButton,"data-active":"table"===G?"true":"false",onClick:()=>R("table"),role:"tab","aria-selected":"table"===G,children:"Table"}),(0,n.jsx)("button",{type:"button",className:i().tabButton,"data-active":"cards"===G?"true":"false",onClick:()=>R("cards"),role:"tab","aria-selected":"cards"===G,children:"Cards"})]})}),(0,n.jsx)(accounts_AccountTypeTabs,{activeTab:F,onTabChange:W,tabs:tx}),(0,n.jsxs)("div",{className:i().searchContainer,children:[(0,n.jsx)(u.jRj,{className:i().searchIcon,"aria-hidden":!0}),(0,n.jsx)("input",{type:"search",className:i().searchInput,placeholder:"Search accounts…",value:X,onChange:t=>tT(t.target.value),"aria-label":"Search accounts"}),X&&(0,n.jsx)("button",{type:"button",className:i().searchClearButton,onClick:()=>tT(""),"aria-label":"Clear search",children:(0,n.jsx)(u.q5L,{"aria-hidden":!0})})]}),tH]}),v?(0,n.jsx)("div",{className:i().tableCard,role:"alert",children:(0,n.jsxs)("div",{className:i().emptyState,children:[(0,n.jsx)("p",{children:v}),(0,n.jsx)("button",{type:"button",className:i().primaryButton,onClick:tC,disabled:h,children:"Retry"})]})}):"cards"===G?(0,n.jsx)(accounts_AccountsCardsView,{accounts:tr,onQuickAction:t=>tN("accounts",t)}):(0,n.jsx)("div",{className:i().tableWrapper,children:(0,n.jsx)(accounts_TableAccounts,{tableScrollRef:te,accounts:tm,selectedIds:f,onSelectRow:tb,onSelectAll:tv,selectionSummary:th,pagination:tS,columnDefinitions:d,allColumns:tc,visibleColumns:tl,isColumnReorderMode:!1,onColumnVisibilityChange:tg,onColumnOrderChange:tf,sortState:P,onSortChange:ty,isFetching:h,isShowingSelectedOnly:S,onEditAccount:tk})})]}),(0,n.jsx)("footer",{className:i().pageFooter,"aria-label":"Accounts footer",children:(0,n.jsx)("span",{className:i().footerNote,children:"Accounts sync nightly • Preview data"})})]}),(0,n.jsx)(x.Z,{type:null!=U?U:"account",isOpen:null!==U,onClose:tA,onSubmit:tw}),(0,n.jsx)(B.Z,{context:"accounts",open:V,onClose:()=>K(!1),columns:ts,defaultColumns:ti,onChange:tB}),(0,n.jsx)(accounts_AccountEditModal,{account:Z,isOpen:null!==Z,onClose:tI,onSubmit:tM})]})}},9890:function(t){t.exports={root:"AccountTypeTabs_root__MsbM0",tabButton:"AccountTypeTabs_tabButton__a14PO",tabLabel:"AccountTypeTabs_tabLabel__N_S4P",tabCount:"AccountTypeTabs_tabCount__B2wf9"}},8305:function(t){t.exports={screen:"accounts_screen__yKPxo TransactionsHistory_screen__baLUC",pageShell:"accounts_pageShell__QACS8",pageContent:"accounts_pageContent__6omth",topBar:"accounts_topBar__ODQ_v",unifiedTopBar:"accounts_unifiedTopBar___50bc",actionBar:"accounts_actionBar__NKbcO",searchContainer:"accounts_searchContainer__wDsie",searchIcon:"accounts_searchIcon__NsSsH",searchInput:"accounts_searchInput__28mqU TransactionsHistory_searchInput__tg7lr",searchClearButton:"accounts_searchClearButton__L_HSX TransactionsHistory_searchClearButton__dggnO",filterActions:"accounts_filterActions__aPfrZ",filterActionsQuickAdd:"accounts_filterActionsQuickAdd__TN1a0",pageFooter:"accounts_pageFooter__BCsb9",footerNote:"accounts_footerNote__UYA_N",pageHeader:"accounts_pageHeader__h4MAO",pageTitleGroup:"accounts_pageTitleGroup__T698o",srOnly:"accounts_srOnly__KN6Cu",pageSubtitle:"accounts_pageSubtitle__Yscw8",pageHeaderActions:"accounts_pageHeaderActions__CN5W8",headerTabGroup:"accounts_headerTabGroup__ECSvg",viewTabs:"accounts_viewTabs___1ezd",tabIndicator:"accounts_tabIndicator__0i1Iu",tabButton:"accounts_tabButton__m6K3H",toolbarCard:"accounts_toolbarCard___qKiI TransactionsHistory_toolbarCard__Ft5nj",toolbarLeft:"accounts_toolbarLeft__Xrid6 TransactionsHistory_toolbarLeft__ty8Ki",searchGroup:"accounts_searchGroup__OvD6a TransactionsHistory_searchGroup__ogjGU",searchIconButton:"accounts_searchIconButton__6PT6u TransactionsHistory_searchIconButton__o2fMa",searchSubmitButton:"accounts_searchSubmitButton__kduht TransactionsHistory_searchSubmitButton__YwRyr",searchSubmitIcon:"accounts_searchSubmitIcon__pBeIk TransactionsHistory_searchSubmitIcon__je9zS",searchSubmitText:"accounts_searchSubmitText__0qSBa TransactionsHistory_searchSubmitText__7RsHp",searchRestoreButton:"accounts_searchRestoreButton__g9VLE TransactionsHistory_searchRestoreButton__WTPZP",searchInputActions:"accounts_searchInputActions__pk59c TransactionsHistory_searchInputActions__T7eFK",actionsGroup:"accounts_actionsGroup___7LdS TransactionsHistory_actionsGroup__5ePbZ",customizeActionsGroup:"accounts_customizeActionsGroup__oiDXJ TransactionsHistory_customizeActionsGroup__uYKD1",primaryButton:"accounts_primaryButton__6GLAq TransactionsHistory_primaryButton__6QKyL",iconPrimaryButton:"accounts_iconPrimaryButton__QxUEJ TransactionsHistory_iconPrimaryButton__CDtGL",secondaryButton:"accounts_secondaryButton__GHEyd TransactionsHistory_secondaryButton__OMUuB",toolbarIconButton:"accounts_toolbarIconButton__IRS0k TransactionsHistory_toolbarIconButton__Eav1O",filterButton:"accounts_filterButton__UgU9S TransactionsHistory_filterButton__eWuDI",filterButtonActive:"accounts_filterButtonActive__lWVvm TransactionsHistory_filterButtonActive__JRdIW",customizeButtonText:"accounts_customizeButtonText__yInR9 TransactionsHistory_customizeButtonText__76rpU",customizeToolbarActions:"accounts_customizeToolbarActions__6h9e2 TransactionsHistory_customizeToolbarActions__PwR0q",customizeSelectAll:"accounts_customizeSelectAll__GQpUr TransactionsHistory_customizeSelectAll__NGiMa",resetButtonText:"accounts_resetButtonText__ltjO6 TransactionsHistory_resetButtonText__wXBph",toolbarSearchRow:"accounts_toolbarSearchRow__skoxz",searchFieldCluster:"accounts_searchFieldCluster__1x9oZ",searchButtonGroup:"accounts_searchButtonGroup__b_E4D",toolbarActionRow:"accounts_toolbarActionRow__DMe_o",selectionActions:"accounts_selectionActions__Q9GbL",customizeRow:"accounts_customizeRow__c7oVc",customizeToggleGroup:"accounts_customizeToggleGroup__q3HNL",customizeActionsCluster:"accounts_customizeActionsCluster__MbhS_",toggleSwitch:"accounts_toggleSwitch__TofiQ",toggleVisual:"accounts_toggleVisual__oNFhE",toggleLabel:"accounts_toggleLabel___XpYh",tableCard:"accounts_tableCard__o7UeH undefined",emptyState:"accounts_emptyState__Yb92a undefined",cardsGrid:"accounts_cardsGrid__MD0lX",accountCard:"accounts_accountCard__pUImi",cardMedia:"accounts_cardMedia__k_pcp",cardOverlay:"accounts_cardOverlay__GKt0G",cardContent:"accounts_cardContent__ujE0P",cardTitle:"accounts_cardTitle__N_8V8",cardMeta:"accounts_cardMeta__t_Ff_",cardBalance:"accounts_cardBalance__P92_C",cardFooter:"accounts_cardFooter___GBSb",statusBadge:"accounts_statusBadge__qjI5y",statusActive:"accounts_statusActive__hO1eu",statusPending:"accounts_statusPending__edfF7",statusInactive:"accounts_statusInactive__N_f5S",statusNeutral:"accounts_statusNeutral__SNvTB",cardQuickActions:"accounts_cardQuickActions__jSvFH",quickActionButton:"accounts_quickActionButton__XvYEg",quickDockLabel:"accounts_quickDockLabel__sN8Zt TransactionsHistory_srOnly__2LGzz",cardsEmpty:"accounts_cardsEmpty__h_F0m undefined",tableWrapper:"accounts_tableWrapper__bBQco undefined",tableHeader:"accounts_tableHeader__qtvUt",tableHeaderTitle:"accounts_tableHeaderTitle__ykzxo",selectionCount:"accounts_selectionCount____Sr1 TransactionsHistory_selectionCount___Jqij",paginationControls:"accounts_paginationControls__N8eEz TransactionsHistory_paginationControls__Loigg",paginationButton:"accounts_paginationButton__cMrFp TransactionsHistory_paginationButton__ABbUY",paginationButtonText:"accounts_paginationButtonText__5L7Wv TransactionsHistory_paginationButtonText__WxCg2",fontScaleButton:"accounts_fontScaleButton__fRgO4 TransactionsHistory_fontScaleButton__TXs3I",fontScaleButtonText:"accounts_fontScaleButtonText__j_8Bs TransactionsHistory_fontScaleButtonText__uJCcc",pageSizeGroup:"accounts_pageSizeGroup__DOvtT TransactionsHistory_pageSizeGroup__fyr3G",pageSizeSelect:"accounts_pageSizeSelect__ODUV5 TransactionsHistory_pageSizeSelect__YmWRs",fontScaleReset:"accounts_fontScaleReset__igv6c TransactionsHistory_fontScaleReset__Ng6Rz",paginationMeta:"accounts_paginationMeta__sDUG4 TransactionsHistory_paginationMeta__bnI7O",fontScaleMeta:"accounts_fontScaleMeta__uVTH_ TransactionsHistory_fontScaleMeta__siKyk",fontScaleLabel:"accounts_fontScaleLabel__9lPi6 TransactionsHistory_fontScaleLabel__NoTE0",fontScaleValue:"accounts_fontScaleValue__KCZrv TransactionsHistory_fontScaleValue__eOzU4",paginationStatus:"accounts_paginationStatus__UC42R TransactionsHistory_paginationStatus__BtArC",columnSubline:"accounts_columnSubline__8oTLs",headerActionButtons:"accounts_headerActionButtons__zrs0E",filtersSection:"accounts_filtersSection__Nt5if",triggerIcon:"accounts_triggerIcon__QQnoV",tableQuickActions:"accounts_tableQuickActions__fUOSA",tableQuickActionButton:"accounts_tableQuickActionButton__3vg2j accounts_quickActionButton__XvYEg"}}},function(t){t.O(0,[285,45,901,568,958,774,888,179],function(){return t(t.s=1091)}),_N_E=t.O()}]);