"use strict";(()=>{var e={};e.id=2382,e.ids=[2382],e.modules={1081:e=>{e.exports=require("dotenv/config")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7612:e=>{e.exports=import("drizzle-orm")},1749:e=>{e.exports=import("drizzle-orm/node-postgres")},8358:e=>{e.exports=import("drizzle-orm/pg-core")},8678:e=>{e.exports=import("pg")},6113:e=>{e.exports=require("crypto")},1663:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{config:()=>d,default:()=>u,routeModule:()=>p});var s=t(1802),a=t(7153),n=t(6249),i=t(1259),l=e([i]);i=(l.then?(await l)():l)[0];let u=(0,n.l)(i,"default"),d=(0,n.l)(i,"config"),p=new s.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/shops",pathname:"/api/shops",bundlePath:"",filename:""},userland:i});o()}catch(e){o(e)}})},1259:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{default:()=>handler});var s=t(7612),a=t(6113),n=t(4379),i=t(6391),l=e([s,n,i]);async function handler(e,r){let t=n.db;if(!t){console.error("Database connection is not configured"),r.status(500).json({error:"Database connection is not configured"});return}if("GET"===e.method){try{let e=await t.select().from(i.Of).orderBy((0,s.asc)(i.Of.shopName));r.status(200).json(e)}catch(t){console.error("Failed to fetch shops",t);let e=t instanceof Error?t.message:"Unknown error";r.status(500).json({error:e})}return}if("POST"===e.method){try{let o=e.body||{};if(!o.shopName||!o.shopType||!o.status){r.status(400).json({error:"Validation failed",details:"shopName, shopType, and status are required"});return}let s=i.Ms.enumValues;if(!s.includes(o.shopType)){r.status(400).json({error:"Validation failed",details:`shopType must be one of: ${s.join(", ")}`});return}let n=i.kz.enumValues;if(!n.includes(o.status)){r.status(400).json({error:"Validation failed",details:`status must be one of: ${n.join(", ")}`});return}let l={shopId:(0,a.randomUUID)(),shopName:o.shopName,shopType:o.shopType,imgUrl:o.imgUrl||null,url:o.url||null,status:o.status,notes:o.notes||null},u=await t.insert(i.Of).values(l).returning();r.status(201).json(u[0])}catch(t){console.error("Failed to create shop",t);let e=t instanceof Error?t.message:"Unknown error";r.status(500).json({error:e})}return}r.setHeader("Allow",["GET","POST"]),r.status(405).json({error:"Method not allowed"})}[s,n,i]=l.then?(await l)():l,o()}catch(e){o(e)}})}};var r=require("../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[4222,4379,6391],()=>__webpack_exec__(1663));module.exports=t})();