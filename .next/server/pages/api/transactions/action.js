"use strict";(()=>{var e={};e.id=7344,e.ids=[7344],e.modules={1081:e=>{e.exports=require("dotenv/config")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7612:e=>{e.exports=import("drizzle-orm")},1749:e=>{e.exports=import("drizzle-orm/node-postgres")},8358:e=>{e.exports=import("drizzle-orm/pg-core")},8678:e=>{e.exports=import("pg")},9824:(e,t,n)=>{n.a(e,async(e,a)=>{try{n.r(t),n.d(t,{config:()=>l,default:()=>u,routeModule:()=>d});var r=n(1802),s=n(7153),i=n(6249),o=n(8308),c=e([o]);o=(c.then?(await c)():c)[0];let u=(0,i.l)(o,"default"),l=(0,i.l)(o,"config"),d=new r.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/transactions/action",pathname:"/api/transactions/action",bundlePath:"",filename:""},userland:o});a()}catch(e){a(e)}})},3165:(e,t,n)=>{n.a(e,async(e,a)=>{try{n.d(t,{w:()=>executeTransactionAction});var r=n(8968),s=n(1637),i=e([r]);function roundCurrency(e){return Number(e.toFixed(2))}function normalizeIds(e){return Array.isArray(e)?e.filter(e=>"string"==typeof e&&e.trim().length>0):"string"==typeof e&&e.trim().length>0?[e.trim()]:[]}async function calculateSelectionTotals(e){let t=await (0,r.n)(),n=t.filter(t=>e.includes(t.id));return n.reduce((e,t)=>(e.count+=1,e.amount+=t.amount,e.totalBack+=t.totalBack,e.finalPrice+=t.finalPrice,e),{count:0,amount:0,totalBack:0,finalPrice:0})}async function handleQuickEdit(e){let t="string"==typeof e.id?e.id:"";if(!t)return{status:"error",message:"Missing transaction id for quick edit."};let n=await (0,r.n)(),a=n.find(e=>e.id===t);if(!a)return{status:"error",message:`Transaction ${t} not found.`};let s="object"==typeof e.updates&&e.updates?e.updates:{},i=function(e,t){let n={...e};if("string"==typeof t.notes&&(n.notes=t.notes.trim()),"string"==typeof t.category&&(n.category=t.category.trim()),"string"==typeof t.owner&&(n.owner=t.owner.trim()),void 0!==t.amount){let e=Number(t.amount);Number.isFinite(e)&&(n.amount=e)}if(void 0!==t.percentBack){let e=Number(t.percentBack);Number.isFinite(e)&&(n.percentBack=e)}if(void 0!==t.fixedBack){let e=Number(t.fixedBack);Number.isFinite(e)&&(n.fixedBack=e)}return(0,r.d)(n)}(a,s);return{status:"success",message:"Transaction updated successfully (simulation).",updatedRow:i}}async function handleSyncSelection(e){let t=normalizeIds(e.ids);if(0===t.length)return{status:"success",message:"No transactions selected.",summary:{count:0,amount:0,totalBack:0,finalPrice:0}};let n=await calculateSelectionTotals(t);return{status:"success",message:"Selection summary recalculated.",summary:{count:n.count,amount:roundCurrency(n.amount),totalBack:roundCurrency(n.totalBack),finalPrice:roundCurrency(n.finalPrice)}}}async function executeTransactionAction(e){let t=e.payload??{};switch(e.action){case"quickEdit":return handleQuickEdit(t);case"delete":return function(e){let t="string"==typeof e.id?e.id:"";return t?{status:"success",message:`Transaction ${t} deleted (simulation).`,removedIds:[t]}:{status:"error",message:"Missing transaction id for delete action."}}(t);case"bulkDelete":return function(e){let t=normalizeIds(e.ids);return 0===t.length?{status:"error",message:"Provide at least one transaction id to delete."}:{status:"success",message:`Deleted ${t.length} transactions (simulation).`,removedIds:t}}(t);case"syncSelection":return handleSyncSelection(t);case"syncPermissions":return function(){let e=(0,s.C)();return{status:"success",message:"Permissions refreshed.",permissions:e.availableActions.map(e=>e.id)}}();default:return{status:"error",message:`Unsupported action: ${e.action}`}}}r=(i.then?(await i)():i)[0],a()}catch(e){a(e)}})},8308:(e,t,n)=>{n.a(e,async(e,a)=>{try{n.r(t),n.d(t,{default:()=>handler});var r=n(3165),s=e([r]);async function handler(e,t){if("POST"!==e.method){t.setHeader("Allow",["POST"]),t.status(405).json({error:"Method not allowed"});return}let n=e.body??{},a={action:"string"==typeof n.action?n.action:"syncSelection",payload:"object"==typeof n.payload?n.payload:{}},s=await (0,r.w)(a),i="error"===s.status?400:200;t.status(i).json(s)}r=(s.then?(await s)():s)[0],a()}catch(e){a(e)}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),n=t.X(0,[4222,4379,6340,3902,6986,6391,7492,7056,1637,8968],()=>__webpack_exec__(9824));module.exports=n})();