"use strict";(()=>{var e={};e.id=133,e.ids=[133],e.modules={1081:e=>{e.exports=require("dotenv/config")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7612:e=>{e.exports=import("drizzle-orm")},1749:e=>{e.exports=import("drizzle-orm/node-postgres")},8358:e=>{e.exports=import("drizzle-orm/pg-core")},8678:e=>{e.exports=import("pg")},7236:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{config:()=>l,default:()=>u,routeModule:()=>p});var s=r(1802),n=r(7153),a=r(6249),i=r(9163),d=e([i]);i=(d.then?(await d)():d)[0];let u=(0,a.l)(i,"default"),l=(0,a.l)(i,"config"),p=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/shops/[id]",pathname:"/api/shops/[id]",bundlePath:"",filename:""},userland:i});o()}catch(e){o(e)}})},9163:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{default:()=>handler});var s=r(7612),n=r(4379),a=r(6391),i=e([s,n,a]);async function handler(e,t){let r=n.db;if(!r){console.error("Database connection is not configured"),t.status(500).json({error:"Database connection is not configured"});return}let{id:o}=e.query,i=Array.isArray(o)?o[0]:o;if(!i){t.status(400).json({message:"Shop id is required"});return}if("GET"===e.method){try{let e=await r.select().from(a.Of).where((0,s.eq)(a.Of.shopId,i));if(0===e.length){t.status(404).json({message:"Shop not found"});return}t.status(200).json(e[0])}catch(r){console.error(`Failed to fetch shop with id ${i}`,r);let e=r instanceof Error?r.message:"Unknown error";t.status(500).json({error:e})}return}if("PUT"===e.method||"PATCH"===e.method){try{let o=e.body||{},n={};if(void 0!==o.shopName&&(n.shopName=o.shopName),void 0!==o.imgUrl&&(n.imgUrl=o.imgUrl),void 0!==o.url&&(n.url=o.url),void 0!==o.notes&&(n.notes=o.notes),void 0!==o.shopType){let e=a.Ms.enumValues;if(!e.includes(o.shopType)){t.status(400).json({error:"Validation failed",details:`shopType must be one of: ${e.join(", ")}`});return}n.shopType=o.shopType}if(void 0!==o.status){let e=a.kz.enumValues;if(!e.includes(o.status)){t.status(400).json({error:"Validation failed",details:`status must be one of: ${e.join(", ")}`});return}n.status=o.status}n.updatedAt=new Date;let d=Object.keys(n).filter(e=>"updatedAt"!==e);if(0===d.length){t.status(400).json({error:"No valid fields to update"});return}let u=await r.update(a.Of).set(n).where((0,s.eq)(a.Of.shopId,i)).returning();if(0===u.length){t.status(404).json({message:"Shop not found"});return}t.status(200).json(u[0])}catch(r){console.error(`Failed to update shop with id ${i}`,r);let e=r instanceof Error?r.message:"Unknown error";t.status(500).json({error:e})}return}if("DELETE"===e.method){try{let e=await r.delete(a.Of).where((0,s.eq)(a.Of.shopId,i)).returning();if(0===e.length){t.status(404).json({message:"Shop not found"});return}t.status(200).json(e[0])}catch(r){console.error(`Failed to delete shop with id ${i}`,r);let e=r instanceof Error?r.message:"Unknown error";t.status(500).json({error:e})}return}t.setHeader("Allow",["GET","PUT","PATCH","DELETE"]),t.status(405).json({error:"Method not allowed"})}[s,n,a]=i.then?(await i)():i,o()}catch(e){o(e)}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[4222,4379,6391],()=>__webpack_exec__(7236));module.exports=r})();