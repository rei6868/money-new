"use strict";exports.id=8968,exports.ids=[8968],exports.modules={8968:(e,t,a)=>{a.a(e,async(e,n)=>{try{a.d(t,{d:()=>recalculateRewardFields,n:()=>loadTransactionDataset});var c=a(7612),o=a(8358),r=a(1606),i=a(4379),d=a(3685),l=a(7126),s=a(6986),u=a(7798),m=a(6340),y=a(6391),p=a(7492),g=e([c,o,i,d,l,s,u,m,y,p]);function toNumber(e,t=0){let a=Number(e);return Number.isFinite(a)?a:t}[c,o,i,d,l,s,u,m,y,p]=g.then?(await g)():g;let T=new Intl.DateTimeFormat("en-US",{month:"long",timeZone:"UTC"});function toTitleCase(e){return e?e.split(/[_\s-]+/g).filter(Boolean).map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" "):""}function buildFallbackDataset(){return(0,r.y)().map(e=>(function(e){let t=e.date??"",a=Number.isFinite(e.sortDate)?e.sortDate:new Date(`${t}T00:00:00Z`).getTime(),n=e.occurredOn??t,c=e.displayDate??t,o="string"==typeof e.type?e.type.trim():"";return{id:e.id??"",date:t,occurredOn:n,displayDate:c,sortDate:Number.isFinite(a)?a:Number.NEGATIVE_INFINITY,year:e.year??"",month:e.month??"",account:e.account??"",shop:e.shop??"",notes:e.notes??"",amount:toNumber(e.amount),percentBack:toNumber(e.percentBack),fixedBack:toNumber(e.fixedBack),totalBack:toNumber(e.totalBack),finalPrice:toNumber(e.finalPrice),debtTag:e.debtTag??"",cycleTag:e.cycleTag??"",category:e.category??"",linkedTxn:e.linkedTxn??"",owner:e.owner??"",type:o,amountDirection:"income"===o.trim().toLowerCase()?"credit":"debit"}})(e))}function normalizeCycleTag(e){return e?.trim()??""}async function loadTransactionDataset(){let e=(0,i.zA)();if(!e)return buildFallbackDataset();try{let t=(0,o.alias)(m.M,"account_owner"),[a,n,r]=await Promise.all([e.select({transactionId:p.dx.transactionId,occurredOn:p.dx.occurredOn,createdAt:p.dx.createdAt,amount:p.dx.amount,fee:p.dx.fee,type:p.dx.type,status:p.dx.status,notes:p.dx.notes,accountId:p.dx.accountId,personId:p.dx.personId,categoryId:p.dx.categoryId,shopId:p.dx.shopId,linkedTxnId:p.dx.linkedTxnId,accountName:d.MI.accountName,accountOwnerName:t.fullName,personName:m.M.fullName,categoryName:s.b.name,shopName:y.Of.shopName}).from(p.dx).leftJoin(d.MI,(0,c.eq)(p.dx.accountId,d.MI.accountId)).leftJoin(t,(0,c.eq)(d.MI.ownerId,t.personId)).leftJoin(m.M,(0,c.eq)(p.dx.personId,m.M.personId)).leftJoin(s.b,(0,c.eq)(p.dx.categoryId,s.b.categoryId)).leftJoin(y.Of,(0,c.eq)(p.dx.shopId,y.Of.shopId)),e.select({transactionId:l.Bh.transactionId,cashbackType:l.Bh.cashbackType,cashbackValue:l.Bh.cashbackValue,cashbackAmount:l.Bh.cashbackAmount,cycleTag:l.Bh.cycleTag}).from(l.Bh),e.select({transactionId:u.iJ.transactionId,movementType:u.iJ.movementType,cycleTag:u.iJ.cycleTag,notes:u.iJ.notes}).from(u.iJ)]),i=new Map;for(let e of n){if(!e.transactionId)continue;let t=i.get(e.transactionId)??{percentBack:0,fixedBack:0,totalBack:0,cycleTag:""},a=toNumber(e.cashbackAmount);"percent"===e.cashbackType?t.percentBack=toNumber(e.cashbackValue):"fixed"===e.cashbackType&&(t.fixedBack+=toNumber(e.cashbackValue)),t.totalBack+=a,!t.cycleTag&&e.cycleTag&&(t.cycleTag=normalizeCycleTag(e.cycleTag)),i.set(e.transactionId,t)}let g=new Map;for(let e of r){if(!e.transactionId)continue;let t=function(e){let t=normalizeCycleTag(e.cycleTag),a=toTitleCase(e.movementType),n=e.notes?.trim()??"",c=[a,t].filter(Boolean).join(" ");return{debtTag:c||t||n,cycleTag:t}}(e);if(!g.has(e.transactionId)){g.set(e.transactionId,t);continue}let a=g.get(e.transactionId);!a.debtTag&&t.debtTag&&(a.debtTag=t.debtTag),!a.cycleTag&&t.cycleTag&&(a.cycleTag=t.cycleTag)}return a.map(e=>(function(e,t,a){let n=toNumber(e.amount),c=function(e){if(!e)return"";if(e instanceof Date)return Number.isNaN(e.getTime())?"":e.toISOString().slice(0,10);if("string"==typeof e){let t=e.trim();if(!t)return"";let a=new Date(`${t}T00:00:00Z`);return Number.isNaN(a.getTime())?t:a.toISOString().slice(0,10)}return""}(e.occurredOn),o=c?new Date(`${c}T00:00:00Z`):null,r=o?o.getTime():Number.NEGATIVE_INFINITY,i=!o||Number.isNaN(o.getTime())?"":T.format(o),d=o&&!Number.isNaN(o.getTime())?String(o.getUTCFullYear()):"",l=e.type??"",s=toTitleCase(l)||"Expense",u=t.get(e.transactionId)??{percentBack:0,fixedBack:0,totalBack:0,cycleTag:""},m=a.get(e.transactionId)??{debtTag:"",cycleTag:""},y=u.totalBack,p=Number((n-y).toFixed(2)),g=e.personName??e.accountOwnerName??"",k=m.cycleTag||u.cycleTag;return{id:e.transactionId,date:c,occurredOn:c,displayDate:c,sortDate:Number.isFinite(r)?r:Number.NEGATIVE_INFINITY,year:d,month:i,account:e.accountName??e.accountId??"",shop:e.shopName??"",notes:e.notes??"",amount:n,percentBack:u.percentBack,fixedBack:u.fixedBack,totalBack:y,finalPrice:p,debtTag:m.debtTag,cycleTag:k,category:e.categoryName??"",linkedTxn:e.linkedTxnId??"",owner:g,type:s,amountDirection:"income"===l?"credit":"debit"}})(e,i,g))}catch(e){return console.error("Failed to load transactions from Neon, falling back to mock dataset.",e),buildFallbackDataset()}}function recalculateRewardFields(e){let t=Number((e.amount*e.percentBack/100+e.fixedBack).toFixed(2)),a=Number((e.amount-t).toFixed(2));return{...e,totalBack:t,finalPrice:a}}n()}catch(e){n(e)}})},1606:(e,t,a)=>{a.d(t,{y:()=>getMockTransactions});let n=new Intl.DateTimeFormat("en-US",{month:"long"}),c=new Intl.DateTimeFormat("en-GB",{day:"2-digit",month:"2-digit",year:"2-digit"}),o=[{id:"txn-0001",date:"2025-02-12",type:"Expense",account:"Primary Checking",shop:"Aurora Grocers",notes:"Weekly grocery run",amount:184.67,percentBack:4,fixedBack:6.5,debtTag:"Household",cycleTag:"Cycle 02",category:"Groceries",linkedTxn:"LNK-2387",owner:"Rena"},{id:"txn-0002",date:"2025-02-13",type:"Income",account:"Rewards Wallet",shop:"Cashback Flow",notes:"February cashback release",amount:320,percentBack:0,fixedBack:0,debtTag:"Rebate",cycleTag:"Cycle 02",category:"Cashback",linkedTxn:"LNK-1803",owner:"Iris"},{id:"txn-0003",date:"2025-02-16",type:"Expense",account:"Primary Checking",shop:"Metro Fuel",notes:"Fuel top-up",amount:76.12,percentBack:2,fixedBack:0,debtTag:"Auto",cycleTag:"Cycle 02",category:"Transport",linkedTxn:"LNK-2387",owner:"Rena"},{id:"txn-0004",date:"2025-02-18",type:"Expense",account:"Corporate Card",shop:"Cloud Nine Cafe",notes:"Client meeting brunch",amount:142.35,percentBack:5,fixedBack:8,debtTag:"Client - Juno",cycleTag:"Cycle 02",category:"Hospitality",linkedTxn:"LNK-2012",owner:"Noah"},{id:"txn-0005",date:"2025-02-21",type:"Expense",account:"Primary Checking",shop:"HealthFirst Pharmacy",notes:"Monthly prescriptions",amount:92.85,percentBack:3,fixedBack:4,debtTag:"Healthcare",cycleTag:"Cycle 02",category:"Health",linkedTxn:"LNK-1099",owner:"Iris"},{id:"txn-0006",date:"2025-02-23",type:"Expense",account:"Corporate Card",shop:"Skyline Suites",notes:"Conference travel lodging",amount:612.5,percentBack:6,fixedBack:12.5,debtTag:"Travel - Summit",cycleTag:"Cycle 02",category:"Travel",linkedTxn:"LNK-3011",owner:"Noah"},{id:"txn-0007",date:"2025-02-24",type:"Expense",account:"Cash Reserve",shop:"BrightLine Utilities",notes:"Electric bill",amount:128,percentBack:1,fixedBack:0,debtTag:"Utilities",cycleTag:"Cycle 02",category:"Utilities",linkedTxn:"LNK-1144",owner:"Rena"},{id:"txn-0008",date:"2025-03-01",type:"Expense",account:"Primary Checking",shop:"Orbit Electronics",notes:"Monitor upgrade",amount:412,percentBack:5,fixedBack:10,debtTag:"Workspace",cycleTag:"Cycle 03",category:"Office",linkedTxn:"LNK-2791",owner:"Rena"},{id:"txn-0009",date:"2025-03-03",type:"Income",account:"Reimbursements",shop:"Debt Movements",notes:"Debt repayment - Summit",amount:450,percentBack:0,fixedBack:0,debtTag:"Travel - Summit",cycleTag:"Cycle 03",category:"Debt",linkedTxn:"LNK-3011",owner:"Noah"},{id:"txn-0010",date:"2025-03-06",type:"Expense",account:"Subscription Wallet",shop:"SaaSify",notes:"Quarterly CRM renewal",amount:899.99,percentBack:7,fixedBack:18,debtTag:"Operations",cycleTag:"Cycle 03",category:"Subscription",linkedTxn:"LNK-3344",owner:"Iris"},{id:"txn-0011",date:"2025-03-08",type:"Expense",account:"Batch Input",shop:"Market Collective",notes:"Bulk inventory purchase",amount:1275.45,percentBack:5,fixedBack:22.5,debtTag:"Inventory",cycleTag:"Cycle 03",category:"Inventory",linkedTxn:"LNK-4588",owner:"Noah"},{id:"txn-0012",date:"2025-03-09",type:"Expense",account:"Primary Checking",shop:"City Fitness",notes:"Team wellness stipend",amount:210,percentBack:4,fixedBack:6,debtTag:"HR",cycleTag:"Cycle 03",category:"Benefits",linkedTxn:"LNK-4588",owner:"Iris"}].map(function(e){let t=Number((e.amount*(e.percentBack??0)/100+(e.fixedBack??0)).toFixed(2)),a=Number((e.amount-t).toFixed(2)),o=new Date(`${e.date}T00:00:00`),r=!Number.isNaN(o.getTime());return{...e,totalBack:t,finalPrice:a,occurredOn:r?o.toISOString().slice(0,10):e.date,year:r?String(o.getFullYear()):"",month:r?n.format(o):"",displayDate:r?c.format(o):e.date,sortDate:r?o.getTime():Number.NEGATIVE_INFINITY}});function getMockTransactions(){return o.map(e=>({...e}))}}};