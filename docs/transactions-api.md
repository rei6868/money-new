# Transactions API Endpoints

This document describes the backend routes that power the Transactions table after the Sprint 3 cleanup. The API surface is now
focused on delivering the core table data, search integration, and restore payloads – filters and column sorting are no longer
available.

## Base Table Endpoint

- **Route:** `GET /api/transactions`
- **Purpose:** Fetch table data with the applied search query and pagination settings.
- **Query Parameters:**
  - `search` – optional free text query across the transaction id, notes, shop, account, category, owner, debt tag, cycle tag, and linked transaction fields.
  - `page`, `pageSize` – pagination controls (defaults 1 / 25).
  - `restoreToken` or `X-Transaction-Restore` header – optional base64 token generated by a previous response to restore the last view state.
- **Response Body (excerpt):**
  ```json
  {
    "rows": [
      {
        "id": "txn-0002",
        "occurredOn": "2025-02-13",
        "amount": 320,
        "totalBack": 0,
        "finalPrice": 320,
        "owner": "Iris",
        "category": "Cashback"
      }
    ],
    "pagination": { "page": 1, "pageSize": 25, "totalRows": 42, "totalPages": 2 },
    "totals": { "count": 42, "amount": 8421.12, "totalBack": 612.77, "finalPrice": 7808.35 },
    "meta": {
      "availableColumns": [...],
      "stickyColumns": { "left": ["date", "shop"], "right": ["amount", "finalPrice"] },
      "availableActions": ["quickEdit", "delete", "bulkDelete", "syncSelection", "syncPermissions"],
      "fieldMapping": { "amount": "amount", "date": "occurredOn" },
      "formatSettings": {
        "currency": { "locale": "en-US", "currency": "USD" },
        "date": { "locale": "en-US", "options": { "year": "numeric", "month": "short", "day": "2-digit" } }
      },
      "pagination": { "defaultPageSize": 25, "maxPageSize": 200 }
    },
    "searchTerm": "cashback",
    "restore": { "token": "<base64>", "state": { "searchTerm": "cashback", "pagination": { "page": 1, "pageSize": 25 } } },
    "execution": { "durationMs": 52.18 },
    "generatedAt": "2025-02-25T12:30:00.000Z"
  }
  ```

## Restore Endpoint

- **Route:** `POST /api/transactions/restore`
- **Purpose:** Rehydrate the table state from a restore token and optional overrides (search term or pagination adjustments).
- **Request Body:**
  ```json
  {
    "restoreToken": "<base64>",
    "state": {
      "searchTerm": "groceries",
      "pagination": { "page": 2, "pageSize": 50 }
    }
  }
  ```
- **Response:** Same schema as the base table endpoint with the merged search/pagination state applied.

## Action Endpoint

- **Route:** `POST /api/transactions/action`
- **Purpose:** Execute row/bulk operations (quick edit, delete, bulk delete, sync selection totals, sync permissions).
- **Payload:**
  ```json
  {
    "action": "quickEdit",
    "payload": {
      "id": "txn-0002",
      "updates": { "notes": "Updated cashback note" }
    }
  }
  ```
- **Response:**
  ```json
  {
    "status": "success",
    "message": "Transaction updated successfully (simulation).",
    "updatedRow": { ... }
  }
  ```

The simplified API keeps the table lean while preserving restore tokens, column metadata, and action workflows.
